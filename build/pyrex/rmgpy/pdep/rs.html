<!DOCTYPE html>
<!-- Generated by Cython 0.21 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code  { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 20px;  }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p>Generated by Cython 0.21</p>
<p>Raw output: <a href="rs.c">rs.c</a></p>
<div class="cython"><pre class='cython line score-11' onclick='toggleDiv(this)'>+001: ################################################################################</pre>
<pre class='cython code score-11'>  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='cython line score-0'>&#xA0;002: #</pre>
<pre class='cython line score-0'>&#xA0;003: #   RMG - Reaction Mechanism Generator</pre>
<pre class='cython line score-0'>&#xA0;004: #</pre>
<pre class='cython line score-0'>&#xA0;005: #   Copyright (c) 2002-2009 Prof. William H. Green (whgreen@mit.edu) and the</pre>
<pre class='cython line score-0'>&#xA0;006: #   RMG Team (rmg_dev@mit.edu)</pre>
<pre class='cython line score-0'>&#xA0;007: #</pre>
<pre class='cython line score-0'>&#xA0;008: #   Permission is hereby granted, free of charge, to any person obtaining a</pre>
<pre class='cython line score-0'>&#xA0;009: #   copy of this software and associated documentation files (the "Software"),</pre>
<pre class='cython line score-0'>&#xA0;010: #   to deal in the Software without restriction, including without limitation</pre>
<pre class='cython line score-0'>&#xA0;011: #   the rights to use, copy, modify, merge, publish, distribute, sublicense,</pre>
<pre class='cython line score-0'>&#xA0;012: #   and/or sell copies of the Software, and to permit persons to whom the</pre>
<pre class='cython line score-0'>&#xA0;013: #   Software is furnished to do so, subject to the following conditions:</pre>
<pre class='cython line score-0'>&#xA0;014: #</pre>
<pre class='cython line score-0'>&#xA0;015: #   The above copyright notice and this permission notice shall be included in</pre>
<pre class='cython line score-0'>&#xA0;016: #   all copies or substantial portions of the Software.</pre>
<pre class='cython line score-0'>&#xA0;017: #</pre>
<pre class='cython line score-0'>&#xA0;018: #   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</pre>
<pre class='cython line score-0'>&#xA0;019: #   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</pre>
<pre class='cython line score-0'>&#xA0;020: #   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</pre>
<pre class='cython line score-0'>&#xA0;021: #   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</pre>
<pre class='cython line score-0'>&#xA0;022: #   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</pre>
<pre class='cython line score-0'>&#xA0;023: #   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</pre>
<pre class='cython line score-0'>&#xA0;024: #   DEALINGS IN THE SOFTWARE.</pre>
<pre class='cython line score-0'>&#xA0;025: #</pre>
<pre class='cython line score-0'>&#xA0;026: ################################################################################</pre>
<pre class='cython line score-0'>&#xA0;027: </pre>
<pre class='cython line score-0'>&#xA0;028: """</pre>
<pre class='cython line score-0'>&#xA0;029: Contains functionality for computing pressure-dependent phenomenological</pre>
<pre class='cython line score-0'>&#xA0;030: rate coefficients :math:`k(T,P)` using the reservoir state method.</pre>
<pre class='cython line score-0'>&#xA0;031: """</pre>
<pre class='cython line score-0'>&#xA0;032: </pre>
<pre class='cython line score-8' onclick='toggleDiv(this)'>+033: import numpy</pre>
<pre class='cython code score-8'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_numpy, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;034: cimport numpy</pre>
<pre class='cython line score-8' onclick='toggleDiv(this)'>+035: import scipy.linalg</pre>
<pre class='cython code score-8'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_linalg, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_scipy, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;036: </pre>
<pre class='cython line score-0'>&#xA0;037: from libc.math cimport exp, log, sqrt</pre>
<pre class='cython line score-0'>&#xA0;038: </pre>
<pre class='cython line score-16' onclick='toggleDiv(this)'>+039: import rmgpy.constants as constants</pre>
<pre class='cython code score-16'>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__19);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__19);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_rmgpy_constants, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_constants, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='cython line score-0'>&#xA0;040: </pre>
<pre class='cython line score-0'>&#xA0;041: ################################################################################</pre>
<pre class='cython line score-0'>&#xA0;042: </pre>
<pre class='cython line score-18' onclick='toggleDiv(this)'>+043: class ReservoirStateError(Exception):</pre>
<pre class='cython code score-18'>  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_Exception);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_builtin_Exception);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_builtin_Exception);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_CalculateMetaclass</span>(NULL, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_t_2, __pyx_n_s_ReservoirStateError, __pyx_n_s_ReservoirStateError, (PyObject *) NULL, __pyx_n_s_rmgpy_pdep_rs, __pyx_kp_s_An_exception_raised_when_the_re);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_ReservoirStateError, __pyx_t_2, __pyx_t_3, NULL, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ReservoirStateError, __pyx_t_4) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='cython line score-0'>&#xA0;044:     """</pre>
<pre class='cython line score-0'>&#xA0;045:     An exception raised when the reservoir state method is unsuccessful for</pre>
<pre class='cython line score-0'>&#xA0;046:     any reason. Pass a string describing the cause of the exceptional behavior.</pre>
<pre class='cython line score-0'>&#xA0;047:     """</pre>
<pre class='cython line score-0'>&#xA0;048:     pass</pre>
<pre class='cython line score-0'>&#xA0;049: </pre>
<pre class='cython line score-0'>&#xA0;050: ################################################################################</pre>
<pre class='cython line score-0'>&#xA0;051: </pre>
<pre class='cython line score-113' onclick='toggleDiv(this)'>+052: cpdef applyReservoirStateMethod(network):</pre>
<pre class='cython code score-113'>static PyObject *__pyx_pw_5rmgpy_4pdep_2rs_1applyReservoirStateMethod(PyObject *__pyx_self, PyObject *__pyx_v_network); /*proto*/
static PyObject *__pyx_f_5rmgpy_4pdep_2rs_applyReservoirStateMethod(PyObject *__pyx_v_network, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyArrayObject *__pyx_v_Jlist = 0;
  PyArrayObject *__pyx_v_Nres = 0;
  PyArrayObject *__pyx_v_Nact = 0;
  PyArrayObject *__pyx_v_indices = 0;
  PyArrayObject *__pyx_v_Elist = 0;
  CYTHON_UNUSED PyArrayObject *__pyx_v_collFreq = 0;
  CYTHON_UNUSED PyArrayObject *__pyx_v_E0 = 0;
  PyArrayObject *__pyx_v_L = 0;
  PyArrayObject *__pyx_v_Z = 0;
  PyArrayObject *__pyx_v_X = 0;
  PyArrayObject *__pyx_v_K = 0;
  PyArrayObject *__pyx_v_densStates = 0;
  PyArrayObject *__pyx_v_eqDist = 0;
  PyArrayObject *__pyx_v_Kij = 0;
  PyArrayObject *__pyx_v_Gnj = 0;
  PyArrayObject *__pyx_v_Fim = 0;
  PyArrayObject *__pyx_v_pa = 0;
  PyArrayObject *__pyx_v_Mcoll = 0;
  PyObject *__pyx_v_ind = 0;
  double __pyx_v_T;
  CYTHON_UNUSED double __pyx_v_P;
  double __pyx_v_tol;
  double __pyx_v_y;
  double __pyx_v_beta;
  int __pyx_v_Nisom;
  int __pyx_v_Nreac;
  int __pyx_v_Nprod;
  int __pyx_v_Ngrains;
  int __pyx_v_NJ;
  int __pyx_v_bandwidth;
  int __pyx_v_halfbandwidth;
  int __pyx_v_width;
  int __pyx_v_width0;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_n;
  int __pyx_v_r;
  int __pyx_v_s;
  int __pyx_v_u;
  int __pyx_v_v;
  int __pyx_v_row;
  PyObject *__pyx_v_ratio = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_E0;
  __Pyx_Buffer __pyx_pybuffer_E0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Elist;
  __Pyx_Buffer __pyx_pybuffer_Elist;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Fim;
  __Pyx_Buffer __pyx_pybuffer_Fim;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Gnj;
  __Pyx_Buffer __pyx_pybuffer_Gnj;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Jlist;
  __Pyx_Buffer __pyx_pybuffer_Jlist;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_K;
  __Pyx_Buffer __pyx_pybuffer_K;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Kij;
  __Pyx_Buffer __pyx_pybuffer_Kij;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_L;
  __Pyx_Buffer __pyx_pybuffer_L;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Mcoll;
  __Pyx_Buffer __pyx_pybuffer_Mcoll;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Nact;
  __Pyx_Buffer __pyx_pybuffer_Nact;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Nres;
  __Pyx_Buffer __pyx_pybuffer_Nres;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_X;
  __Pyx_Buffer __pyx_pybuffer_X;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Z;
  __Pyx_Buffer __pyx_pybuffer_Z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_collFreq;
  __Pyx_Buffer __pyx_pybuffer_collFreq;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_densStates;
  __Pyx_Buffer __pyx_pybuffer_densStates;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_eqDist;
  __Pyx_Buffer __pyx_pybuffer_eqDist;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_indices;
  __Pyx_Buffer __pyx_pybuffer_indices;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pa;
  __Pyx_Buffer __pyx_pybuffer_pa;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("applyReservoirStateMethod", 0);
  __pyx_pybuffer_Jlist.pybuffer.buf = NULL;
  __pyx_pybuffer_Jlist.refcount = 0;
  __pyx_pybuffernd_Jlist.data = NULL;
  __pyx_pybuffernd_Jlist.rcbuffer = &amp;__pyx_pybuffer_Jlist;
  __pyx_pybuffer_Nres.pybuffer.buf = NULL;
  __pyx_pybuffer_Nres.refcount = 0;
  __pyx_pybuffernd_Nres.data = NULL;
  __pyx_pybuffernd_Nres.rcbuffer = &amp;__pyx_pybuffer_Nres;
  __pyx_pybuffer_Nact.pybuffer.buf = NULL;
  __pyx_pybuffer_Nact.refcount = 0;
  __pyx_pybuffernd_Nact.data = NULL;
  __pyx_pybuffernd_Nact.rcbuffer = &amp;__pyx_pybuffer_Nact;
  __pyx_pybuffer_indices.pybuffer.buf = NULL;
  __pyx_pybuffer_indices.refcount = 0;
  __pyx_pybuffernd_indices.data = NULL;
  __pyx_pybuffernd_indices.rcbuffer = &amp;__pyx_pybuffer_indices;
  __pyx_pybuffer_Elist.pybuffer.buf = NULL;
  __pyx_pybuffer_Elist.refcount = 0;
  __pyx_pybuffernd_Elist.data = NULL;
  __pyx_pybuffernd_Elist.rcbuffer = &amp;__pyx_pybuffer_Elist;
  __pyx_pybuffer_collFreq.pybuffer.buf = NULL;
  __pyx_pybuffer_collFreq.refcount = 0;
  __pyx_pybuffernd_collFreq.data = NULL;
  __pyx_pybuffernd_collFreq.rcbuffer = &amp;__pyx_pybuffer_collFreq;
  __pyx_pybuffer_E0.pybuffer.buf = NULL;
  __pyx_pybuffer_E0.refcount = 0;
  __pyx_pybuffernd_E0.data = NULL;
  __pyx_pybuffernd_E0.rcbuffer = &amp;__pyx_pybuffer_E0;
  __pyx_pybuffer_L.pybuffer.buf = NULL;
  __pyx_pybuffer_L.refcount = 0;
  __pyx_pybuffernd_L.data = NULL;
  __pyx_pybuffernd_L.rcbuffer = &amp;__pyx_pybuffer_L;
  __pyx_pybuffer_Z.pybuffer.buf = NULL;
  __pyx_pybuffer_Z.refcount = 0;
  __pyx_pybuffernd_Z.data = NULL;
  __pyx_pybuffernd_Z.rcbuffer = &amp;__pyx_pybuffer_Z;
  __pyx_pybuffer_X.pybuffer.buf = NULL;
  __pyx_pybuffer_X.refcount = 0;
  __pyx_pybuffernd_X.data = NULL;
  __pyx_pybuffernd_X.rcbuffer = &amp;__pyx_pybuffer_X;
  __pyx_pybuffer_K.pybuffer.buf = NULL;
  __pyx_pybuffer_K.refcount = 0;
  __pyx_pybuffernd_K.data = NULL;
  __pyx_pybuffernd_K.rcbuffer = &amp;__pyx_pybuffer_K;
  __pyx_pybuffer_densStates.pybuffer.buf = NULL;
  __pyx_pybuffer_densStates.refcount = 0;
  __pyx_pybuffernd_densStates.data = NULL;
  __pyx_pybuffernd_densStates.rcbuffer = &amp;__pyx_pybuffer_densStates;
  __pyx_pybuffer_eqDist.pybuffer.buf = NULL;
  __pyx_pybuffer_eqDist.refcount = 0;
  __pyx_pybuffernd_eqDist.data = NULL;
  __pyx_pybuffernd_eqDist.rcbuffer = &amp;__pyx_pybuffer_eqDist;
  __pyx_pybuffer_Kij.pybuffer.buf = NULL;
  __pyx_pybuffer_Kij.refcount = 0;
  __pyx_pybuffernd_Kij.data = NULL;
  __pyx_pybuffernd_Kij.rcbuffer = &amp;__pyx_pybuffer_Kij;
  __pyx_pybuffer_Gnj.pybuffer.buf = NULL;
  __pyx_pybuffer_Gnj.refcount = 0;
  __pyx_pybuffernd_Gnj.data = NULL;
  __pyx_pybuffernd_Gnj.rcbuffer = &amp;__pyx_pybuffer_Gnj;
  __pyx_pybuffer_Fim.pybuffer.buf = NULL;
  __pyx_pybuffer_Fim.refcount = 0;
  __pyx_pybuffernd_Fim.data = NULL;
  __pyx_pybuffernd_Fim.rcbuffer = &amp;__pyx_pybuffer_Fim;
  __pyx_pybuffer_pa.pybuffer.buf = NULL;
  __pyx_pybuffer_pa.refcount = 0;
  __pyx_pybuffernd_pa.data = NULL;
  __pyx_pybuffernd_pa.rcbuffer = &amp;__pyx_pybuffer_pa;
  __pyx_pybuffer_Mcoll.pybuffer.buf = NULL;
  __pyx_pybuffer_Mcoll.refcount = 0;
  __pyx_pybuffernd_Mcoll.data = NULL;
  __pyx_pybuffernd_Mcoll.rcbuffer = &amp;__pyx_pybuffer_Mcoll;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_86);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_196);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_197);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_198);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_L.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("rmgpy.pdep.rs.applyReservoirStateMethod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_L.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Jlist);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Nres);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Nact);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Elist);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_collFreq);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_E0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_L);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Z);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_X);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_K);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_densStates);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_eqDist);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Kij);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Gnj);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Fim);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pa);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Mcoll);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ind);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ratio);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_5rmgpy_4pdep_2rs_1applyReservoirStateMethod(PyObject *__pyx_self, PyObject *__pyx_v_network); /*proto*/
static PyObject *__pyx_pw_5rmgpy_4pdep_2rs_1applyReservoirStateMethod(PyObject *__pyx_self, PyObject *__pyx_v_network) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("applyReservoirStateMethod (wrapper)", 0);
  __pyx_r = __pyx_pf_5rmgpy_4pdep_2rs_applyReservoirStateMethod(__pyx_self, ((PyObject *)__pyx_v_network));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_5rmgpy_4pdep_2rs_applyReservoirStateMethod(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_network) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("applyReservoirStateMethod", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_5rmgpy_4pdep_2rs_applyReservoirStateMethod(__pyx_v_network, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("rmgpy.pdep.rs.applyReservoirStateMethod", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='cython line score-0'>&#xA0;053: </pre>
<pre class='cython line score-0'>&#xA0;054:     cdef numpy.ndarray[numpy.int_t,ndim=1] Jlist</pre>
<pre class='cython line score-0'>&#xA0;055:     cdef numpy.ndarray[numpy.int_t,ndim=2] Nres, Nact</pre>
<pre class='cython line score-0'>&#xA0;056:     cdef numpy.ndarray[numpy.int_t,ndim=3] indices</pre>
<pre class='cython line score-0'>&#xA0;057:     cdef numpy.ndarray[numpy.float64_t,ndim=1] Elist, collFreq, E0</pre>
<pre class='cython line score-0'>&#xA0;058:     cdef numpy.ndarray[numpy.float64_t,ndim=2] L, Z, X, K</pre>
<pre class='cython line score-0'>&#xA0;059:     cdef numpy.ndarray[numpy.float64_t,ndim=3] densStates, eqDist</pre>
<pre class='cython line score-0'>&#xA0;060:     cdef numpy.ndarray[numpy.float64_t,ndim=4] Kij, Gnj, Fim, pa</pre>
<pre class='cython line score-0'>&#xA0;061:     cdef numpy.ndarray[numpy.float64_t,ndim=5] Mcoll</pre>
<pre class='cython line score-0'>&#xA0;062:     cdef list ind</pre>
<pre class='cython line score-0'>&#xA0;063:     cdef double T, P, E, tol, y, dfactor, beta</pre>
<pre class='cython line score-0'>&#xA0;064:     cdef int Nisom, Nreac, Nprod, Ngrains, NJ, bandwidth, halfbandwidth, width, width0</pre>
<pre class='cython line score-0'>&#xA0;065:     cdef int i, j, n, r, s, u, v, row, iter</pre>
<pre class='cython line score-0'>&#xA0;066: </pre>
<pre class='cython line score-8' onclick='toggleDiv(this)'>+067:     T = network.T</pre>
<pre class='cython code score-8'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_T);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_T = __pyx_t_2;
</pre><pre class='cython line score-8' onclick='toggleDiv(this)'>+068:     P = network.P</pre>
<pre class='cython code score-8'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_P);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_P = __pyx_t_2;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+069:     Elist = network.Elist</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Elist);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_3, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Elist, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_Elist.diminfo[0].strides = __pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Elist.diminfo[0].shape = __pyx_pybuffernd_Elist.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_3 = 0;
  __pyx_v_Elist = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+070:     Jlist = network.Jlist</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Jlist);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Jlist, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_Jlist.diminfo[0].strides = __pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Jlist.diminfo[0].shape = __pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = 0;
  __pyx_v_Jlist = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+071:     densStates = network.densStates</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_densStates);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_densStates, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_densStates.diminfo[0].strides = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_densStates.diminfo[0].shape = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_densStates.diminfo[1].strides = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_densStates.diminfo[1].shape = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_densStates.diminfo[2].strides = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_densStates.diminfo[2].shape = __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.shape[2];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_9 = 0;
  __pyx_v_densStates = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+072:     collFreq = network.collFreq</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_collFreq);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_3, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_collFreq, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_collFreq.diminfo[0].strides = __pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_collFreq.diminfo[0].shape = __pyx_pybuffernd_collFreq.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_3 = 0;
  __pyx_v_collFreq = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+073:     Mcoll = network.Mcoll</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Mcoll);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 5, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Mcoll, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 5, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_Mcoll.diminfo[0].strides = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Mcoll.diminfo[0].shape = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Mcoll.diminfo[1].strides = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Mcoll.diminfo[1].shape = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Mcoll.diminfo[2].strides = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Mcoll.diminfo[2].shape = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Mcoll.diminfo[3].strides = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Mcoll.diminfo[3].shape = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.shape[3]; __pyx_pybuffernd_Mcoll.diminfo[4].strides = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.strides[4]; __pyx_pybuffernd_Mcoll.diminfo[4].shape = __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.shape[4];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_10 = 0;
  __pyx_v_Mcoll = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+074:     Kij = network.Kij</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Kij);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Kij, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_Kij.diminfo[0].strides = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Kij.diminfo[0].shape = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Kij.diminfo[1].strides = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Kij.diminfo[1].shape = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Kij.diminfo[2].strides = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Kij.diminfo[2].shape = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Kij.diminfo[3].strides = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Kij.diminfo[3].shape = __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.shape[3];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_Kij = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+075:     Fim = network.Fim</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Fim);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Fim, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_Fim.diminfo[0].strides = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Fim.diminfo[0].shape = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Fim.diminfo[1].strides = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Fim.diminfo[1].shape = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Fim.diminfo[2].strides = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Fim.diminfo[2].shape = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Fim.diminfo[3].strides = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Fim.diminfo[3].shape = __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.shape[3];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_Fim = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+076:     Gnj = network.Gnj</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Gnj);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Gnj, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_Gnj.diminfo[0].strides = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Gnj.diminfo[0].shape = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Gnj.diminfo[1].strides = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Gnj.diminfo[1].shape = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Gnj.diminfo[2].strides = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Gnj.diminfo[2].shape = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Gnj.diminfo[3].strides = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Gnj.diminfo[3].shape = __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.shape[3];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_Gnj = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-22' onclick='toggleDiv(this)'>+077:     E0 = network.E0</pre>
<pre class='cython code score-22'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_E0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_3, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_E0, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_E0.diminfo[0].strides = __pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_E0.diminfo[0].shape = __pyx_pybuffernd_E0.rcbuffer-&gt;pybuffer.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_3 = 0;
  __pyx_v_E0 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-5' onclick='toggleDiv(this)'>+078:     Nisom = network.Nisom</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Nisom);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_Nisom = __pyx_t_4;
</pre><pre class='cython line score-5' onclick='toggleDiv(this)'>+079:     Nreac = network.Nreac</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Nreac);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_Nreac = __pyx_t_4;
</pre><pre class='cython line score-5' onclick='toggleDiv(this)'>+080:     Nprod = network.Nprod</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Nprod);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_Nprod = __pyx_t_4;
</pre><pre class='cython line score-5' onclick='toggleDiv(this)'>+081:     Ngrains = network.Ngrains</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_Ngrains = __pyx_t_4;
</pre><pre class='cython line score-5' onclick='toggleDiv(this)'>+082:     NJ = network.NJ</pre>
<pre class='cython code score-5'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_network, __pyx_n_s_NJ);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_NJ = __pyx_t_4;
</pre><pre class='cython line score-0'>&#xA0;083: </pre>
<pre class='cython line score-26' onclick='toggleDiv(this)'>+084:     beta = 1. / (constants.R * T)        # [=] mol/kJ</pre>
<pre class='cython code score-26'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_constants);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_R);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_T);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_13 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_12, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_float_1_, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_beta = __pyx_t_2;
</pre><pre class='cython line score-0'>&#xA0;085: </pre>
<pre class='cython line score-63' onclick='toggleDiv(this)'>+086:     K = numpy.zeros((Nisom+Nreac+Nprod, Nisom+Nreac+Nprod), numpy.float64)</pre>
<pre class='cython code score-63'>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((__pyx_v_Nisom + __pyx_v_Nreac) + __pyx_v_Nprod));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((__pyx_v_Nisom + __pyx_v_Nreac) + __pyx_v_Nprod));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  __pyx_t_13 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  if (__pyx_t_14) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_14); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); __pyx_t_14 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+__pyx_t_16, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1+__pyx_t_16, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  __pyx_t_15 = 0;
  __pyx_t_13 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_12, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_K, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_K.diminfo[0].strides = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_K.diminfo[0].shape = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_K.diminfo[1].strides = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_K.diminfo[1].shape = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_K = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-69' onclick='toggleDiv(this)'>+087:     pa = numpy.zeros((Nisom,Nisom+Nreac,Ngrains,NJ), numpy.float64)</pre>
<pre class='cython code score-69'>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Nisom);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_Nisom + __pyx_v_Nreac));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_NJ);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 3, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  __pyx_t_12 = 0;
  __pyx_t_13 = 0;
  __pyx_t_15 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  if (__pyx_t_14) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_14); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); __pyx_t_14 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_16, __pyx_t_19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_16, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  __pyx_t_19 = 0;
  __pyx_t_15 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 4, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_pa, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 4, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_pa.diminfo[0].strides = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_pa.diminfo[0].shape = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_pa.diminfo[1].strides = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_pa.diminfo[1].shape = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_pa.diminfo[2].strides = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_pa.diminfo[2].shape = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_pa.diminfo[3].strides = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_pa.diminfo[3].shape = __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.shape[3];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_pa = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-0'>&#xA0;088: </pre>
<pre class='cython line score-0'>&#xA0;089:     # Determine the reservoir cutoff grain for each isomer</pre>
<pre class='cython line score-0'>&#xA0;090:     # Start by simply placing it at the lowest reactive grain</pre>
<pre class='cython line score-63' onclick='toggleDiv(this)'>+091:     Nres = numpy.zeros((Nisom,NJ), numpy.int)</pre>
<pre class='cython code score-63'>  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Nisom);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_NJ);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  __pyx_t_17 = 0;
  __pyx_t_15 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_15 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_15)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  if (__pyx_t_15) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_15); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); __pyx_t_15 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_16, __pyx_t_19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_16, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  __pyx_t_19 = 0;
  __pyx_t_17 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Nres, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_Nres.diminfo[0].strides = __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Nres.diminfo[0].shape = __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Nres.diminfo[1].strides = __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Nres.diminfo[1].shape = __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_20 = 0;
  __pyx_v_Nres = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+092:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+093:         for s in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_s = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+094:             for r in range(Ngrains):</pre>
<pre class='cython code score-0'>      __pyx_t_24 = __pyx_v_Ngrains;
      for (__pyx_t_25 = 0; __pyx_t_25 &lt; __pyx_t_24; __pyx_t_25+=1) {
        __pyx_v_r = __pyx_t_25;
</pre><pre class='cython line score-112' onclick='toggleDiv(this)'>+095:                 if densStates[i,r,s] != 0 and ((Kij[:,i,r,s] &gt; 0).any() or (Gnj[:,i,r,s] &gt; 0).any()):</pre>
<pre class='cython code score-112'>        __pyx_t_27 = __pyx_v_i;
        __pyx_t_28 = __pyx_v_r;
        __pyx_t_29 = __pyx_v_s;
        __pyx_t_30 = -1;
        if (__pyx_t_27 &lt; 0) {
          __pyx_t_27 += __pyx_pybuffernd_densStates.diminfo[0].shape;
          if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_30 = 0;
        } else if (unlikely(__pyx_t_27 &gt;= __pyx_pybuffernd_densStates.diminfo[0].shape)) __pyx_t_30 = 0;
        if (__pyx_t_28 &lt; 0) {
          __pyx_t_28 += __pyx_pybuffernd_densStates.diminfo[1].shape;
          if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_30 = 1;
        } else if (unlikely(__pyx_t_28 &gt;= __pyx_pybuffernd_densStates.diminfo[1].shape)) __pyx_t_30 = 1;
        if (__pyx_t_29 &lt; 0) {
          __pyx_t_29 += __pyx_pybuffernd_densStates.diminfo[2].shape;
          if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_30 = 2;
        } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_densStates.diminfo[2].shape)) __pyx_t_30 = 2;
        if (unlikely(__pyx_t_30 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_30);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_31 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.buf, __pyx_t_27, __pyx_pybuffernd_densStates.diminfo[0].strides, __pyx_t_28, __pyx_pybuffernd_densStates.diminfo[1].strides, __pyx_t_29, __pyx_pybuffernd_densStates.diminfo[2].strides)) != 0.0) != 0);
        if (__pyx_t_31) {
          goto __pyx_L11_next_and;
        } else {
          __pyx_t_26 = __pyx_t_31;
          goto __pyx_L10_bool_binop_done;
        }
        __pyx_L11_next_and:;
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_slice_);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_13);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_14);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 3, __pyx_t_17);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
        __pyx_t_13 = 0;
        __pyx_t_14 = 0;
        __pyx_t_17 = 0;
        __pyx_t_17 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Kij), __pyx_t_19);<span class='error_goto'> if (unlikely(__pyx_t_17 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
        __pyx_t_19 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_17, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_19, __pyx_n_s_any);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
        __pyx_t_19 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
          __pyx_t_19 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
          if (likely(__pyx_t_19)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_19);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
          }
        }
        if (__pyx_t_19) {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_17, __pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
        } else {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        __pyx_t_31 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_31 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        if (!__pyx_t_31) {
          goto __pyx_L12_next_or;
        } else {
          __pyx_t_26 = __pyx_t_31;
          goto __pyx_L10_bool_binop_done;
        }
        __pyx_L12_next_or:;
/* … */
  __pyx_slice_ = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__2);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_slice__2);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_17);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_19);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 3, __pyx_t_14);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
        __pyx_t_17 = 0;
        __pyx_t_19 = 0;
        __pyx_t_14 = 0;
        __pyx_t_14 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Gnj), __pyx_t_13);<span class='error_goto'> if (unlikely(__pyx_t_14 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_14, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_any);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
          __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
          if (likely(__pyx_t_13)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
          }
        }
        if (__pyx_t_13) {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        } else {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_31 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_31 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_26 = __pyx_t_31;
        __pyx_L10_bool_binop_done:;
        if (__pyx_t_26) {
  __pyx_slice__2 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
</pre><pre class='cython line score-0'>&#xA0;096:                     # We need at least one reservoir grain for the RS method to be successful</pre>
<pre class='cython line score-2' onclick='toggleDiv(this)'>+097:                     if r == 0 or densStates[i,r-1,s] == 0:</pre>
<pre class='cython code score-2'>          __pyx_t_31 = ((__pyx_v_r == 0) != 0);
          if (!__pyx_t_31) {
            goto __pyx_L15_next_or;
          } else {
            __pyx_t_26 = __pyx_t_31;
            goto __pyx_L14_bool_binop_done;
          }
          __pyx_L15_next_or:;
          __pyx_t_30 = __pyx_v_i;
          __pyx_t_32 = (__pyx_v_r - 1);
          __pyx_t_33 = __pyx_v_s;
          __pyx_t_34 = -1;
          if (__pyx_t_30 &lt; 0) {
            __pyx_t_30 += __pyx_pybuffernd_densStates.diminfo[0].shape;
            if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_34 = 0;
          } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_densStates.diminfo[0].shape)) __pyx_t_34 = 0;
          if (__pyx_t_32 &lt; 0) {
            __pyx_t_32 += __pyx_pybuffernd_densStates.diminfo[1].shape;
            if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_34 = 1;
          } else if (unlikely(__pyx_t_32 &gt;= __pyx_pybuffernd_densStates.diminfo[1].shape)) __pyx_t_34 = 1;
          if (__pyx_t_33 &lt; 0) {
            __pyx_t_33 += __pyx_pybuffernd_densStates.diminfo[2].shape;
            if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_34 = 2;
          } else if (unlikely(__pyx_t_33 &gt;= __pyx_pybuffernd_densStates.diminfo[2].shape)) __pyx_t_34 = 2;
          if (unlikely(__pyx_t_34 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_34);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_31 = (((*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_densStates.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_densStates.diminfo[0].strides, __pyx_t_32, __pyx_pybuffernd_densStates.diminfo[1].strides, __pyx_t_33, __pyx_pybuffernd_densStates.diminfo[2].strides)) == 0.0) != 0);
          __pyx_t_26 = __pyx_t_31;
          __pyx_L14_bool_binop_done:;
          if (__pyx_t_26) {
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+098:                         Nres[i,s] = r + 1</pre>
<pre class='cython code score-2'>            __pyx_t_34 = __pyx_v_i;
            __pyx_t_35 = __pyx_v_s;
            __pyx_t_36 = -1;
            if (__pyx_t_34 &lt; 0) {
              __pyx_t_34 += __pyx_pybuffernd_Nres.diminfo[0].shape;
              if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_36 = 0;
            } else if (unlikely(__pyx_t_34 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_36 = 0;
            if (__pyx_t_35 &lt; 0) {
              __pyx_t_35 += __pyx_pybuffernd_Nres.diminfo[1].shape;
              if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_36 = 1;
            } else if (unlikely(__pyx_t_35 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_36 = 1;
            if (unlikely(__pyx_t_36 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_36);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_34, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_35, __pyx_pybuffernd_Nres.diminfo[1].strides) = (__pyx_v_r + 1);
            goto __pyx_L13;
          }
          /*else*/ {
</pre><pre class='cython line score-0'>&#xA0;099:                     else:</pre>
<pre class='cython line score-2' onclick='toggleDiv(this)'>+100:                         Nres[i,s] = r</pre>
<pre class='cython code score-2'>            __pyx_t_36 = __pyx_v_i;
            __pyx_t_37 = __pyx_v_s;
            __pyx_t_38 = -1;
            if (__pyx_t_36 &lt; 0) {
              __pyx_t_36 += __pyx_pybuffernd_Nres.diminfo[0].shape;
              if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_38 = 0;
            } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_38 = 0;
            if (__pyx_t_37 &lt; 0) {
              __pyx_t_37 += __pyx_pybuffernd_Nres.diminfo[1].shape;
              if (unlikely(__pyx_t_37 &lt; 0)) __pyx_t_38 = 1;
            } else if (unlikely(__pyx_t_37 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_38 = 1;
            if (unlikely(__pyx_t_38 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_38);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_37, __pyx_pybuffernd_Nres.diminfo[1].strides) = __pyx_v_r;
          }
          __pyx_L13:;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+101:                     break</pre>
<pre class='cython code score-0'>          goto __pyx_L8_break;
        }
      }
      __pyx_L8_break:;
    }
  }
</pre><pre class='cython line score-28' onclick='toggleDiv(this)'>+102:     Nact = Ngrains - Nres</pre>
<pre class='cython code score-28'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_14 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_1, ((PyObject *)__pyx_v_Nres));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_14);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_20, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Nact, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_Nact.diminfo[0].strides = __pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Nact.diminfo[0].shape = __pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Nact.diminfo[1].strides = __pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Nact.diminfo[1].shape = __pyx_pybuffernd_Nact.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_20 = 0;
  __pyx_v_Nact = ((PyArrayObject *)__pyx_t_14);
  __pyx_t_14 = 0;
</pre><pre class='cython line score-0'>&#xA0;103: </pre>
<pre class='cython line score-0'>&#xA0;104:     # Determine equilibrium distributions</pre>
<pre class='cython line score-66' onclick='toggleDiv(this)'>+105:     eqDist = numpy.zeros((Nisom+Nreac,Ngrains,NJ), numpy.float64)</pre>
<pre class='cython code score-66'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_Nisom + __pyx_v_Nreac));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_NJ);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, __pyx_t_19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 2, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  __pyx_t_1 = 0;
  __pyx_t_19 = 0;
  __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (__pyx_t_17) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+__pyx_t_16, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1+__pyx_t_16, __pyx_t_19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  __pyx_t_15 = 0;
  __pyx_t_19 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_14);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_eqDist, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_eqDist.diminfo[0].strides = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_eqDist.diminfo[0].shape = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_eqDist.diminfo[1].strides = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_eqDist.diminfo[1].shape = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_eqDist.diminfo[2].strides = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_eqDist.diminfo[2].shape = __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.shape[2];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_9 = 0;
  __pyx_v_eqDist = ((PyArrayObject *)__pyx_t_14);
  __pyx_t_14 = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+106:     for i in range(Nisom+Nreac):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = (__pyx_v_Nisom + __pyx_v_Nreac);
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+107:         for s in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_s = __pyx_t_23;
</pre><pre class='cython line score-113' onclick='toggleDiv(this)'>+108:             eqDist[i,:,s] = densStates[i,:,s] * (2*Jlist[s]+1) * numpy.exp(-Elist * beta)</pre>
<pre class='cython code score-113'>      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_14);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_slice__3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_13);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      __pyx_t_14 = 0;
      __pyx_t_13 = 0;
      __pyx_t_13 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_densStates), __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_13 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_24 = __pyx_v_s;
      __pyx_t_25 = -1;
      if (__pyx_t_24 &lt; 0) {
        __pyx_t_24 += __pyx_pybuffernd_Jlist.diminfo[0].shape;
        if (unlikely(__pyx_t_24 &lt; 0)) __pyx_t_25 = 0;
      } else if (unlikely(__pyx_t_24 &gt;= __pyx_pybuffernd_Jlist.diminfo[0].shape)) __pyx_t_25 = 0;
      if (unlikely(__pyx_t_25 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(((2 * (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Jlist.rcbuffer-&gt;pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_Jlist.diminfo[0].strides))) + 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_14 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_13, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_exp);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      __pyx_t_13 = <span class='py_c_api'>PyNumber_Negative</span>(((PyObject *)__pyx_v_Elist));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_beta);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      __pyx_t_17 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_13, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_15 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_19))) {
        __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_19);
        if (likely(__pyx_t_15)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_19, function);
        }
      }
      if (!__pyx_t_15) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_19, __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_15); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); __pyx_t_15 = NULL;
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+1, __pyx_t_17);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
        __pyx_t_17 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_19, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
      __pyx_t_19 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_14, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
/* … */
  __pyx_slice__3 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_slice__4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_14);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
      __pyx_t_1 = 0;
      __pyx_t_14 = 0;
      if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_eqDist), __pyx_t_13, __pyx_t_19) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    }
  }
  __pyx_slice__4 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
</pre><pre class='cython line score-0'>&#xA0;109: </pre>
<pre class='cython line score-0'>&#xA0;110:     # Determine pseudo-steady state populations of active state</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+111:     row = 0</pre>
<pre class='cython code score-0'>  __pyx_v_row = 0;
</pre><pre class='cython line score-72' onclick='toggleDiv(this)'>+112:     indices = -numpy.ones((Nisom,Ngrains,NJ), numpy.int)</pre>
<pre class='cython code score-72'>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Nisom);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_NJ);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 2, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  __pyx_t_13 = 0;
  __pyx_t_1 = 0;
  __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  if (__pyx_t_17) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_16, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_16, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_15 = 0;
  __pyx_t_1 = 0;
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_14, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  if (!(likely(((__pyx_t_14) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_39 = ((PyArrayObject *)__pyx_t_14);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_39, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_indices, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_indices.diminfo[0].strides = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_indices.diminfo[0].shape = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_indices.diminfo[1].strides = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_indices.diminfo[1].shape = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_indices.diminfo[2].strides = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_indices.diminfo[2].shape = __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.shape[2];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_39 = 0;
  __pyx_v_indices = ((PyArrayObject *)__pyx_t_14);
  __pyx_t_14 = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+113:     for r in range(Ngrains):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Ngrains;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_r = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+114:         for s in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_s = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+115:             for i in range(Nisom):</pre>
<pre class='cython code score-0'>      __pyx_t_25 = __pyx_v_Nisom;
      for (__pyx_t_38 = 0; __pyx_t_38 &lt; __pyx_t_25; __pyx_t_38+=1) {
        __pyx_v_i = __pyx_t_38;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+116:                 if r &gt;= Nres[i,s]:</pre>
<pre class='cython code score-2'>        __pyx_t_40 = __pyx_v_i;
        __pyx_t_41 = __pyx_v_s;
        __pyx_t_42 = -1;
        if (__pyx_t_40 &lt; 0) {
          __pyx_t_40 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_40 &lt; 0)) __pyx_t_42 = 0;
        } else if (unlikely(__pyx_t_40 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_42 = 0;
        if (__pyx_t_41 &lt; 0) {
          __pyx_t_41 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_41 &lt; 0)) __pyx_t_42 = 1;
        } else if (unlikely(__pyx_t_41 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_42 = 1;
        if (unlikely(__pyx_t_42 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_42);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_26 = ((__pyx_v_r &gt;= (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_40, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_41, __pyx_pybuffernd_Nres.diminfo[1].strides))) != 0);
        if (__pyx_t_26) {
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+117:                     indices[i,r,s] = row</pre>
<pre class='cython code score-2'>          __pyx_t_42 = __pyx_v_i;
          __pyx_t_43 = __pyx_v_r;
          __pyx_t_44 = __pyx_v_s;
          __pyx_t_45 = -1;
          if (__pyx_t_42 &lt; 0) {
            __pyx_t_42 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_42 &lt; 0)) __pyx_t_45 = 0;
          } else if (unlikely(__pyx_t_42 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_45 = 0;
          if (__pyx_t_43 &lt; 0) {
            __pyx_t_43 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_43 &lt; 0)) __pyx_t_45 = 1;
          } else if (unlikely(__pyx_t_43 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_45 = 1;
          if (__pyx_t_44 &lt; 0) {
            __pyx_t_44 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_44 &lt; 0)) __pyx_t_45 = 2;
          } else if (unlikely(__pyx_t_44 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_45 = 2;
          if (unlikely(__pyx_t_45 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_45);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_42, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_43, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_44, __pyx_pybuffernd_indices.diminfo[2].strides) = __pyx_v_row;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+118:                     row += 1</pre>
<pre class='cython code score-0'>          __pyx_v_row = (__pyx_v_row + 1);
          goto __pyx_L26;
        }
        __pyx_L26:;
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;119: </pre>
<pre class='cython line score-0'>&#xA0;120:     # Choose the half-bandwidth using the deepest isomer well</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+121:     width = 0</pre>
<pre class='cython code score-0'>  __pyx_v_width = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+122:     tol = 1e-12</pre>
<pre class='cython code score-0'>  __pyx_v_tol = 1e-12;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+123:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+124:         for s in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_s = __pyx_t_23;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+125:             r = Nres[i,s]</pre>
<pre class='cython code score-2'>      __pyx_t_25 = __pyx_v_i;
      __pyx_t_38 = __pyx_v_s;
      __pyx_t_45 = -1;
      if (__pyx_t_25 &lt; 0) {
        __pyx_t_25 += __pyx_pybuffernd_Nres.diminfo[0].shape;
        if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_45 = 0;
      } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_45 = 0;
      if (__pyx_t_38 &lt; 0) {
        __pyx_t_38 += __pyx_pybuffernd_Nres.diminfo[1].shape;
        if (unlikely(__pyx_t_38 &lt; 0)) __pyx_t_45 = 1;
      } else if (unlikely(__pyx_t_38 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_45 = 1;
      if (unlikely(__pyx_t_45 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_45);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_r = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_38, __pyx_pybuffernd_Nres.diminfo[1].strides));
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+126:             if Mcoll[i,r,s,r,s] == 0: continue</pre>
<pre class='cython code score-2'>      __pyx_t_45 = __pyx_v_i;
      __pyx_t_46 = __pyx_v_r;
      __pyx_t_47 = __pyx_v_s;
      __pyx_t_48 = __pyx_v_r;
      __pyx_t_49 = __pyx_v_s;
      __pyx_t_50 = -1;
      if (__pyx_t_45 &lt; 0) {
        __pyx_t_45 += __pyx_pybuffernd_Mcoll.diminfo[0].shape;
        if (unlikely(__pyx_t_45 &lt; 0)) __pyx_t_50 = 0;
      } else if (unlikely(__pyx_t_45 &gt;= __pyx_pybuffernd_Mcoll.diminfo[0].shape)) __pyx_t_50 = 0;
      if (__pyx_t_46 &lt; 0) {
        __pyx_t_46 += __pyx_pybuffernd_Mcoll.diminfo[1].shape;
        if (unlikely(__pyx_t_46 &lt; 0)) __pyx_t_50 = 1;
      } else if (unlikely(__pyx_t_46 &gt;= __pyx_pybuffernd_Mcoll.diminfo[1].shape)) __pyx_t_50 = 1;
      if (__pyx_t_47 &lt; 0) {
        __pyx_t_47 += __pyx_pybuffernd_Mcoll.diminfo[2].shape;
        if (unlikely(__pyx_t_47 &lt; 0)) __pyx_t_50 = 2;
      } else if (unlikely(__pyx_t_47 &gt;= __pyx_pybuffernd_Mcoll.diminfo[2].shape)) __pyx_t_50 = 2;
      if (__pyx_t_48 &lt; 0) {
        __pyx_t_48 += __pyx_pybuffernd_Mcoll.diminfo[3].shape;
        if (unlikely(__pyx_t_48 &lt; 0)) __pyx_t_50 = 3;
      } else if (unlikely(__pyx_t_48 &gt;= __pyx_pybuffernd_Mcoll.diminfo[3].shape)) __pyx_t_50 = 3;
      if (__pyx_t_49 &lt; 0) {
        __pyx_t_49 += __pyx_pybuffernd_Mcoll.diminfo[4].shape;
        if (unlikely(__pyx_t_49 &lt; 0)) __pyx_t_50 = 4;
      } else if (unlikely(__pyx_t_49 &gt;= __pyx_pybuffernd_Mcoll.diminfo[4].shape)) __pyx_t_50 = 4;
      if (unlikely(__pyx_t_50 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_50);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_26 = (((*__Pyx_BufPtrStrided5d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_Mcoll.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_Mcoll.diminfo[1].strides, __pyx_t_47, __pyx_pybuffernd_Mcoll.diminfo[2].strides, __pyx_t_48, __pyx_pybuffernd_Mcoll.diminfo[3].strides, __pyx_t_49, __pyx_pybuffernd_Mcoll.diminfo[4].strides)) == 0.0) != 0);
      if (__pyx_t_26) {
        goto __pyx_L29_continue;
      }
</pre><pre class='cython line score-71' onclick='toggleDiv(this)'>+127:             ratio = numpy.abs(Mcoll[i,:,s,r,s] / Mcoll[i,r,s,r,s])</pre>
<pre class='cython code score-71'>      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_19, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
      __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_s);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
      __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_19);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_slice__5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3, __pyx_t_15);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 4, __pyx_t_17);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
      __pyx_t_19 = 0;
      __pyx_t_1 = 0;
      __pyx_t_15 = 0;
      __pyx_t_17 = 0;
      __pyx_t_17 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Mcoll), __pyx_t_12);<span class='error_goto'> if (unlikely(__pyx_t_17 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_50 = __pyx_v_i;
      __pyx_t_51 = __pyx_v_r;
      __pyx_t_52 = __pyx_v_s;
      __pyx_t_53 = __pyx_v_r;
      __pyx_t_54 = __pyx_v_s;
      __pyx_t_55 = -1;
      if (__pyx_t_50 &lt; 0) {
        __pyx_t_50 += __pyx_pybuffernd_Mcoll.diminfo[0].shape;
        if (unlikely(__pyx_t_50 &lt; 0)) __pyx_t_55 = 0;
      } else if (unlikely(__pyx_t_50 &gt;= __pyx_pybuffernd_Mcoll.diminfo[0].shape)) __pyx_t_55 = 0;
      if (__pyx_t_51 &lt; 0) {
        __pyx_t_51 += __pyx_pybuffernd_Mcoll.diminfo[1].shape;
        if (unlikely(__pyx_t_51 &lt; 0)) __pyx_t_55 = 1;
      } else if (unlikely(__pyx_t_51 &gt;= __pyx_pybuffernd_Mcoll.diminfo[1].shape)) __pyx_t_55 = 1;
      if (__pyx_t_52 &lt; 0) {
        __pyx_t_52 += __pyx_pybuffernd_Mcoll.diminfo[2].shape;
        if (unlikely(__pyx_t_52 &lt; 0)) __pyx_t_55 = 2;
      } else if (unlikely(__pyx_t_52 &gt;= __pyx_pybuffernd_Mcoll.diminfo[2].shape)) __pyx_t_55 = 2;
      if (__pyx_t_53 &lt; 0) {
        __pyx_t_53 += __pyx_pybuffernd_Mcoll.diminfo[3].shape;
        if (unlikely(__pyx_t_53 &lt; 0)) __pyx_t_55 = 3;
      } else if (unlikely(__pyx_t_53 &gt;= __pyx_pybuffernd_Mcoll.diminfo[3].shape)) __pyx_t_55 = 3;
      if (__pyx_t_54 &lt; 0) {
        __pyx_t_54 += __pyx_pybuffernd_Mcoll.diminfo[4].shape;
        if (unlikely(__pyx_t_54 &lt; 0)) __pyx_t_55 = 4;
      } else if (unlikely(__pyx_t_54 &gt;= __pyx_pybuffernd_Mcoll.diminfo[4].shape)) __pyx_t_55 = 4;
      if (unlikely(__pyx_t_55 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_55);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided5d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.buf, __pyx_t_50, __pyx_pybuffernd_Mcoll.diminfo[0].strides, __pyx_t_51, __pyx_pybuffernd_Mcoll.diminfo[1].strides, __pyx_t_52, __pyx_pybuffernd_Mcoll.diminfo[2].strides, __pyx_t_53, __pyx_pybuffernd_Mcoll.diminfo[3].strides, __pyx_t_54, __pyx_pybuffernd_Mcoll.diminfo[4].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_17, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
        __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
        if (likely(__pyx_t_12)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
        }
      }
      if (!__pyx_t_12) {
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      } else {
        __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_12); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); __pyx_t_12 = NULL;
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0+1, __pyx_t_15);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
        __pyx_t_15 = 0;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_ratio, __pyx_t_14);
      __pyx_t_14 = 0;
/* … */
  __pyx_slice__5 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
</pre><pre class='cython line score-62' onclick='toggleDiv(this)'>+128:             ind = [j for j,y in enumerate(ratio) if y &gt; tol]</pre>
<pre class='cython code score-62'>      __pyx_t_14 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_55 = 0;
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_ratio)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_ratio)) {
        __pyx_t_13 = __pyx_v_ratio; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13); __pyx_t_16 = 0;
        __pyx_t_56 = NULL;
      } else {
        __pyx_t_16 = -1; __pyx_t_13 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_ratio);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        __pyx_t_56 = Py_TYPE(__pyx_t_13)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_56)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      for (;;) {
        if (likely(!__pyx_t_56)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_13))) {
            if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_13)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_17 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_13, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17); __pyx_t_16++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            #else
            __pyx_t_17 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            #endif
          } else {
            if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_13)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_17 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_13, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17); __pyx_t_16++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            #else
            __pyx_t_17 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            #endif
          }
        } else {
          __pyx_t_17 = __pyx_t_56(__pyx_t_13);
          if (unlikely(!__pyx_t_17)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || <span class='py_c_api'>PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        }
        __pyx_t_2 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_17);<span class='error_goto'> if (unlikely((__pyx_t_2 == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        __pyx_v_y = __pyx_t_2;
        __pyx_v_j = __pyx_t_55;
        __pyx_t_55 = (__pyx_t_55 + 1);
        __pyx_t_26 = ((__pyx_v_y &gt; __pyx_v_tol) != 0);
        if (__pyx_t_26) {
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_14, (PyObject*)__pyx_t_17))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          goto __pyx_L34;
        }
        __pyx_L34:;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_ind, ((PyObject*)__pyx_t_14));
      __pyx_t_14 = 0;
</pre><pre class='cython line score-1' onclick='toggleDiv(this)'>+129:             if len(ind) &gt; 0:</pre>
<pre class='cython code score-1'>      __pyx_t_16 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_ind);<span class='error_goto'> if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_26 = ((__pyx_t_16 &gt; 0) != 0);
      if (__pyx_t_26) {
</pre><pre class='cython line score-53' onclick='toggleDiv(this)'>+130:                 width0 = max(r - min(ind), max(ind) - r)</pre>
<pre class='cython code score-53'>        __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ind);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_v_ind);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_ind);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_max, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_17 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_13, __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ind);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_v_ind);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_ind);
        __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_min, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_14, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        __pyx_t_14 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_17, __pyx_t_13, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_26 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        if (__pyx_t_26) {
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
          __pyx_t_15 = __pyx_t_17;
        } else {
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
          __pyx_t_15 = __pyx_t_13;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        __pyx_t_55 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_15);<span class='error_goto'> if (unlikely((__pyx_t_55 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        __pyx_v_width0 = __pyx_t_55;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+131:                 if width0 &gt; width:</pre>
<pre class='cython code score-0'>        __pyx_t_26 = ((__pyx_v_width0 &gt; __pyx_v_width) != 0);
        if (__pyx_t_26) {
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+132:                     width = width0</pre>
<pre class='cython code score-0'>          __pyx_v_width = __pyx_v_width0;
          goto __pyx_L36;
        }
        __pyx_L36:;
        goto __pyx_L35;
      }
      __pyx_L35:;
      __pyx_L29_continue:;
    }
  }
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+133:     if width == 0:</pre>
<pre class='cython code score-0'>  __pyx_t_26 = ((__pyx_v_width == 0) != 0);
  if (__pyx_t_26) {
</pre><pre class='cython line score-13' onclick='toggleDiv(this)'>+134:         raise ReservoirStateError('Unable to determine half-bandwidth for active-state matrix; the wells may be too shallow to use the RS method.')</pre>
<pre class='cython code score-13'>    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_ReservoirStateError);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_15, __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_17, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_Unable_to_determine_half_bandwid);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+135:     halfbandwidth = (width + 1) * Nisom * NJ - Nisom</pre>
<pre class='cython code score-0'>  __pyx_v_halfbandwidth = ((((__pyx_v_width + 1) * __pyx_v_Nisom) * __pyx_v_NJ) - __pyx_v_Nisom);
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+136:     bandwidth = 2 * halfbandwidth + 1</pre>
<pre class='cython code score-0'>  __pyx_v_bandwidth = ((2 * __pyx_v_halfbandwidth) + 1);
</pre><pre class='cython line score-0'>&#xA0;137: </pre>
<pre class='cython line score-0'>&#xA0;138:     # Populate active-state matrix and source vectors</pre>
<pre class='cython line score-90' onclick='toggleDiv(this)'>+139:     L = numpy.zeros((bandwidth,numpy.sum(Nact)), numpy.float64)</pre>
<pre class='cython code score-90'>  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_bandwidth);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_12) {
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, ((PyObject *)__pyx_v_Nact));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  } else {
    __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_12); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); __pyx_t_12 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Nact));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0+1, ((PyObject *)__pyx_v_Nact));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Nact));
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_19, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  __pyx_t_15 = 0;
  __pyx_t_14 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_14)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  if (__pyx_t_14) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_14); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); __pyx_t_14 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0+__pyx_t_16, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1+__pyx_t_16, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  __pyx_t_1 = 0;
  __pyx_t_15 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_19, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (!(likely(((__pyx_t_17) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_17, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_17);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_L.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_L.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_L.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_L, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_L.diminfo[0].strides = __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_L.diminfo[0].shape = __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_L.diminfo[1].strides = __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_L.diminfo[1].shape = __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_L = ((PyArrayObject *)__pyx_t_17);
  __pyx_t_17 = 0;
</pre><pre class='cython line score-90' onclick='toggleDiv(this)'>+140:     Z = numpy.zeros((numpy.sum(Nact),Nisom+Nreac), numpy.float64)</pre>
<pre class='cython code score-90'>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_15 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_15)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_15) {
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, ((PyObject *)__pyx_v_Nact));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  } else {
    __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_15); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); __pyx_t_15 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Nact));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+1, ((PyObject *)__pyx_v_Nact));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Nact));
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_Nisom + __pyx_v_Nreac));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_13 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_19))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_19);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_19, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  if (__pyx_t_1) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_1); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); __pyx_t_1 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_16, __pyx_t_14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_16, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  __pyx_t_14 = 0;
  __pyx_t_13 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_19, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  if (!(likely(((__pyx_t_17) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_17, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_17);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Z, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_Z.diminfo[0].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Z.diminfo[0].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Z.diminfo[1].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Z.diminfo[1].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_Z = ((PyArrayObject *)__pyx_t_17);
  __pyx_t_17 = 0;
</pre><pre class='cython line score-0'>&#xA0;141:     # Collisional terms</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+142:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+143:         for u in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_u = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+144:             for v in range(NJ):</pre>
<pre class='cython code score-0'>      __pyx_t_55 = __pyx_v_NJ;
      for (__pyx_t_57 = 0; __pyx_t_57 &lt; __pyx_t_55; __pyx_t_57+=1) {
        __pyx_v_v = __pyx_t_57;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+145:                 for r in range(Nres[i,u], Ngrains):</pre>
<pre class='cython code score-2'>        __pyx_t_58 = __pyx_v_Ngrains;
        __pyx_t_59 = __pyx_v_i;
        __pyx_t_60 = __pyx_v_u;
        __pyx_t_61 = -1;
        if (__pyx_t_59 &lt; 0) {
          __pyx_t_59 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_59 &lt; 0)) __pyx_t_61 = 0;
        } else if (unlikely(__pyx_t_59 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_61 = 0;
        if (__pyx_t_60 &lt; 0) {
          __pyx_t_60 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_60 &lt; 0)) __pyx_t_61 = 1;
        } else if (unlikely(__pyx_t_60 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_61 = 1;
        if (unlikely(__pyx_t_61 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_61);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        for (__pyx_t_61 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_59, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_60, __pyx_pybuffernd_Nres.diminfo[1].strides)); __pyx_t_61 &lt; __pyx_t_58; __pyx_t_61+=1) {
          __pyx_v_r = __pyx_t_61;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+146:                     for s in range(max(Nres[i,v], r-width), min(Ngrains, r+width+1)):</pre>
<pre class='cython code score-2'>          __pyx_t_62 = ((__pyx_v_r + __pyx_v_width) + 1);
          __pyx_t_63 = __pyx_v_Ngrains;
          if (((__pyx_t_62 &lt; __pyx_t_63) != 0)) {
            __pyx_t_64 = __pyx_t_62;
          } else {
            __pyx_t_64 = __pyx_t_63;
          }
          __pyx_t_62 = __pyx_t_64;
          __pyx_t_63 = (__pyx_v_r - __pyx_v_width);
          __pyx_t_65 = __pyx_v_i;
          __pyx_t_66 = __pyx_v_v;
          __pyx_t_67 = -1;
          if (__pyx_t_65 &lt; 0) {
            __pyx_t_65 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_65 &lt; 0)) __pyx_t_67 = 0;
          } else if (unlikely(__pyx_t_65 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_67 = 0;
          if (__pyx_t_66 &lt; 0) {
            __pyx_t_66 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_66 &lt; 0)) __pyx_t_67 = 1;
          } else if (unlikely(__pyx_t_66 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_67 = 1;
          if (unlikely(__pyx_t_67 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_67);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_68 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_65, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_66, __pyx_pybuffernd_Nres.diminfo[1].strides));
          if (((__pyx_t_63 &gt; __pyx_t_68) != 0)) {
            __pyx_t_69 = __pyx_t_63;
          } else {
            __pyx_t_69 = __pyx_t_68;
          }
          for (__pyx_t_63 = __pyx_t_69; __pyx_t_63 &lt; __pyx_t_62; __pyx_t_63+=1) {
            __pyx_v_s = __pyx_t_63;
</pre><pre class='cython line score-10' onclick='toggleDiv(this)'>+147:                         L[halfbandwidth + indices[i,r,u] - indices[i,s,v], indices[i,s,v]] = Mcoll[i,r,u,s,v]</pre>
<pre class='cython code score-10'>            __pyx_t_67 = __pyx_v_i;
            __pyx_t_70 = __pyx_v_r;
            __pyx_t_71 = __pyx_v_u;
            __pyx_t_72 = __pyx_v_s;
            __pyx_t_73 = __pyx_v_v;
            __pyx_t_74 = -1;
            if (__pyx_t_67 &lt; 0) {
              __pyx_t_67 += __pyx_pybuffernd_Mcoll.diminfo[0].shape;
              if (unlikely(__pyx_t_67 &lt; 0)) __pyx_t_74 = 0;
            } else if (unlikely(__pyx_t_67 &gt;= __pyx_pybuffernd_Mcoll.diminfo[0].shape)) __pyx_t_74 = 0;
            if (__pyx_t_70 &lt; 0) {
              __pyx_t_70 += __pyx_pybuffernd_Mcoll.diminfo[1].shape;
              if (unlikely(__pyx_t_70 &lt; 0)) __pyx_t_74 = 1;
            } else if (unlikely(__pyx_t_70 &gt;= __pyx_pybuffernd_Mcoll.diminfo[1].shape)) __pyx_t_74 = 1;
            if (__pyx_t_71 &lt; 0) {
              __pyx_t_71 += __pyx_pybuffernd_Mcoll.diminfo[2].shape;
              if (unlikely(__pyx_t_71 &lt; 0)) __pyx_t_74 = 2;
            } else if (unlikely(__pyx_t_71 &gt;= __pyx_pybuffernd_Mcoll.diminfo[2].shape)) __pyx_t_74 = 2;
            if (__pyx_t_72 &lt; 0) {
              __pyx_t_72 += __pyx_pybuffernd_Mcoll.diminfo[3].shape;
              if (unlikely(__pyx_t_72 &lt; 0)) __pyx_t_74 = 3;
            } else if (unlikely(__pyx_t_72 &gt;= __pyx_pybuffernd_Mcoll.diminfo[3].shape)) __pyx_t_74 = 3;
            if (__pyx_t_73 &lt; 0) {
              __pyx_t_73 += __pyx_pybuffernd_Mcoll.diminfo[4].shape;
              if (unlikely(__pyx_t_73 &lt; 0)) __pyx_t_74 = 4;
            } else if (unlikely(__pyx_t_73 &gt;= __pyx_pybuffernd_Mcoll.diminfo[4].shape)) __pyx_t_74 = 4;
            if (unlikely(__pyx_t_74 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_74);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_74 = __pyx_v_i;
            __pyx_t_75 = __pyx_v_r;
            __pyx_t_76 = __pyx_v_u;
            __pyx_t_77 = -1;
            if (__pyx_t_74 &lt; 0) {
              __pyx_t_74 += __pyx_pybuffernd_indices.diminfo[0].shape;
              if (unlikely(__pyx_t_74 &lt; 0)) __pyx_t_77 = 0;
            } else if (unlikely(__pyx_t_74 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_77 = 0;
            if (__pyx_t_75 &lt; 0) {
              __pyx_t_75 += __pyx_pybuffernd_indices.diminfo[1].shape;
              if (unlikely(__pyx_t_75 &lt; 0)) __pyx_t_77 = 1;
            } else if (unlikely(__pyx_t_75 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_77 = 1;
            if (__pyx_t_76 &lt; 0) {
              __pyx_t_76 += __pyx_pybuffernd_indices.diminfo[2].shape;
              if (unlikely(__pyx_t_76 &lt; 0)) __pyx_t_77 = 2;
            } else if (unlikely(__pyx_t_76 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_77 = 2;
            if (unlikely(__pyx_t_77 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_77);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_77 = __pyx_v_i;
            __pyx_t_78 = __pyx_v_s;
            __pyx_t_79 = __pyx_v_v;
            __pyx_t_80 = -1;
            if (__pyx_t_77 &lt; 0) {
              __pyx_t_77 += __pyx_pybuffernd_indices.diminfo[0].shape;
              if (unlikely(__pyx_t_77 &lt; 0)) __pyx_t_80 = 0;
            } else if (unlikely(__pyx_t_77 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_80 = 0;
            if (__pyx_t_78 &lt; 0) {
              __pyx_t_78 += __pyx_pybuffernd_indices.diminfo[1].shape;
              if (unlikely(__pyx_t_78 &lt; 0)) __pyx_t_80 = 1;
            } else if (unlikely(__pyx_t_78 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_80 = 1;
            if (__pyx_t_79 &lt; 0) {
              __pyx_t_79 += __pyx_pybuffernd_indices.diminfo[2].shape;
              if (unlikely(__pyx_t_79 &lt; 0)) __pyx_t_80 = 2;
            } else if (unlikely(__pyx_t_79 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_80 = 2;
            if (unlikely(__pyx_t_80 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_80);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_80 = __pyx_v_i;
            __pyx_t_81 = __pyx_v_s;
            __pyx_t_82 = __pyx_v_v;
            __pyx_t_83 = -1;
            if (__pyx_t_80 &lt; 0) {
              __pyx_t_80 += __pyx_pybuffernd_indices.diminfo[0].shape;
              if (unlikely(__pyx_t_80 &lt; 0)) __pyx_t_83 = 0;
            } else if (unlikely(__pyx_t_80 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_83 = 0;
            if (__pyx_t_81 &lt; 0) {
              __pyx_t_81 += __pyx_pybuffernd_indices.diminfo[1].shape;
              if (unlikely(__pyx_t_81 &lt; 0)) __pyx_t_83 = 1;
            } else if (unlikely(__pyx_t_81 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_83 = 1;
            if (__pyx_t_82 &lt; 0) {
              __pyx_t_82 += __pyx_pybuffernd_indices.diminfo[2].shape;
              if (unlikely(__pyx_t_82 &lt; 0)) __pyx_t_83 = 2;
            } else if (unlikely(__pyx_t_82 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_83 = 2;
            if (unlikely(__pyx_t_83 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_83);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_68 = ((__pyx_v_halfbandwidth + (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_74, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_75, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_76, __pyx_pybuffernd_indices.diminfo[2].strides))) - (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_77, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_78, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_79, __pyx_pybuffernd_indices.diminfo[2].strides)));
            __pyx_t_84 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_80, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_81, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_82, __pyx_pybuffernd_indices.diminfo[2].strides));
            __pyx_t_83 = -1;
            if (__pyx_t_68 &lt; 0) {
              __pyx_t_68 += __pyx_pybuffernd_L.diminfo[0].shape;
              if (unlikely(__pyx_t_68 &lt; 0)) __pyx_t_83 = 0;
            } else if (unlikely(__pyx_t_68 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_83 = 0;
            if (__pyx_t_84 &lt; 0) {
              __pyx_t_84 += __pyx_pybuffernd_L.diminfo[1].shape;
              if (unlikely(__pyx_t_84 &lt; 0)) __pyx_t_83 = 1;
            } else if (unlikely(__pyx_t_84 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_83 = 1;
            if (unlikely(__pyx_t_83 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_83);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_68, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_84, __pyx_pybuffernd_L.diminfo[1].strides) = (*__Pyx_BufPtrStrided5d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Mcoll.rcbuffer-&gt;pybuffer.buf, __pyx_t_67, __pyx_pybuffernd_Mcoll.diminfo[0].strides, __pyx_t_70, __pyx_pybuffernd_Mcoll.diminfo[1].strides, __pyx_t_71, __pyx_pybuffernd_Mcoll.diminfo[2].strides, __pyx_t_72, __pyx_pybuffernd_Mcoll.diminfo[3].strides, __pyx_t_73, __pyx_pybuffernd_Mcoll.diminfo[4].strides));
          }
</pre><pre class='cython line score-108' onclick='toggleDiv(this)'>+148:                     Z[indices[i,r,u],i] = numpy.sum(Mcoll[i,r,u,0:Nres[i,u],v] * eqDist[i,0:Nres[i,u],v])</pre>
<pre class='cython code score-108'>          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_19, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_63 = __pyx_v_i;
          __pyx_t_83 = __pyx_v_u;
          __pyx_t_85 = -1;
          if (__pyx_t_63 &lt; 0) {
            __pyx_t_63 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_63 &lt; 0)) __pyx_t_85 = 0;
          } else if (unlikely(__pyx_t_63 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_85 = 0;
          if (__pyx_t_83 &lt; 0) {
            __pyx_t_83 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_83 &lt; 0)) __pyx_t_85 = 1;
          } else if (unlikely(__pyx_t_83 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_85 = 1;
          if (unlikely(__pyx_t_85 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_85);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_63, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_83, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_12 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_1, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_19);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1, __pyx_t_13);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 2, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 3, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 4, __pyx_t_1);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          __pyx_t_19 = 0;
          __pyx_t_13 = 0;
          __pyx_t_14 = 0;
          __pyx_t_12 = 0;
          __pyx_t_1 = 0;
          __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Mcoll), __pyx_t_86);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_85 = __pyx_v_i;
          __pyx_t_87 = __pyx_v_u;
          __pyx_t_88 = -1;
          if (__pyx_t_85 &lt; 0) {
            __pyx_t_85 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_85 &lt; 0)) __pyx_t_88 = 0;
          } else if (unlikely(__pyx_t_85 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_88 = 0;
          if (__pyx_t_87 &lt; 0) {
            __pyx_t_87 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_87 &lt; 0)) __pyx_t_88 = 1;
          } else if (unlikely(__pyx_t_87 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_88 = 1;
          if (unlikely(__pyx_t_88 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_88);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_85, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_87, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_14 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_12, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_86);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          __pyx_t_86 = 0;
          __pyx_t_14 = 0;
          __pyx_t_12 = 0;
          __pyx_t_12 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_eqDist), __pyx_t_13);<span class='error_goto'> if (unlikely(__pyx_t_12 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_13 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
            __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
            if (likely(__pyx_t_12)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
            }
          }
          if (!__pyx_t_12) {
            __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_15, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          } else {
            __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_12); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); __pyx_t_12 = NULL;
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_13);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
            __pyx_t_13 = 0;
            __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_15, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_17);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_t_88 = __pyx_v_i;
          __pyx_t_90 = __pyx_v_r;
          __pyx_t_91 = __pyx_v_u;
          __pyx_t_92 = -1;
          if (__pyx_t_88 &lt; 0) {
            __pyx_t_88 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_88 &lt; 0)) __pyx_t_92 = 0;
          } else if (unlikely(__pyx_t_88 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_92 = 0;
          if (__pyx_t_90 &lt; 0) {
            __pyx_t_90 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_90 &lt; 0)) __pyx_t_92 = 1;
          } else if (unlikely(__pyx_t_90 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_92 = 1;
          if (__pyx_t_91 &lt; 0) {
            __pyx_t_91 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_91 &lt; 0)) __pyx_t_92 = 2;
          } else if (unlikely(__pyx_t_91 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_92 = 2;
          if (unlikely(__pyx_t_92 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_92);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_69 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_88, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_90, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_91, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_92 = __pyx_v_i;
          __pyx_t_93 = -1;
          if (__pyx_t_69 &lt; 0) {
            __pyx_t_69 += __pyx_pybuffernd_Z.diminfo[0].shape;
            if (unlikely(__pyx_t_69 &lt; 0)) __pyx_t_93 = 0;
          } else if (unlikely(__pyx_t_69 &gt;= __pyx_pybuffernd_Z.diminfo[0].shape)) __pyx_t_93 = 0;
          if (__pyx_t_92 &lt; 0) {
            __pyx_t_92 += __pyx_pybuffernd_Z.diminfo[1].shape;
            if (unlikely(__pyx_t_92 &lt; 0)) __pyx_t_93 = 1;
          } else if (unlikely(__pyx_t_92 &gt;= __pyx_pybuffernd_Z.diminfo[1].shape)) __pyx_t_93 = 1;
          if (unlikely(__pyx_t_93 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_93);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_69, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_92, __pyx_pybuffernd_Z.diminfo[1].strides) = __pyx_t_89;
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;149: </pre>
<pre class='cython line score-0'>&#xA0;150:     # Isomerization terms</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+151:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+152:         for j in range(i):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_i;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_j = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+153:             for u in range(NJ):</pre>
<pre class='cython code score-0'>      __pyx_t_55 = __pyx_v_NJ;
      for (__pyx_t_57 = 0; __pyx_t_57 &lt; __pyx_t_55; __pyx_t_57+=1) {
        __pyx_v_u = __pyx_t_57;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+154:                 for r in range(max(Nres[i,u], Nres[j,u]), Ngrains):</pre>
<pre class='cython code score-4'>        __pyx_t_58 = __pyx_v_Ngrains;
        __pyx_t_61 = __pyx_v_j;
        __pyx_t_93 = __pyx_v_u;
        __pyx_t_94 = -1;
        if (__pyx_t_61 &lt; 0) {
          __pyx_t_61 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_61 &lt; 0)) __pyx_t_94 = 0;
        } else if (unlikely(__pyx_t_61 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_94 = 0;
        if (__pyx_t_93 &lt; 0) {
          __pyx_t_93 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_93 &lt; 0)) __pyx_t_94 = 1;
        } else if (unlikely(__pyx_t_93 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_94 = 1;
        if (unlikely(__pyx_t_94 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_94);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_95 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_61, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_93, __pyx_pybuffernd_Nres.diminfo[1].strides));
        __pyx_t_94 = __pyx_v_i;
        __pyx_t_96 = __pyx_v_u;
        __pyx_t_97 = -1;
        if (__pyx_t_94 &lt; 0) {
          __pyx_t_94 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_94 &lt; 0)) __pyx_t_97 = 0;
        } else if (unlikely(__pyx_t_94 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_97 = 0;
        if (__pyx_t_96 &lt; 0) {
          __pyx_t_96 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_96 &lt; 0)) __pyx_t_97 = 1;
        } else if (unlikely(__pyx_t_96 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_97 = 1;
        if (unlikely(__pyx_t_97 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_97);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_98 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_94, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_96, __pyx_pybuffernd_Nres.diminfo[1].strides));
        if (((__pyx_t_95 &gt; __pyx_t_98) != 0)) {
          __pyx_t_99 = __pyx_t_95;
        } else {
          __pyx_t_99 = __pyx_t_98;
        }
        for (__pyx_t_97 = __pyx_t_99; __pyx_t_97 &lt; __pyx_t_58; __pyx_t_97+=1) {
          __pyx_v_r = __pyx_t_97;
</pre><pre class='cython line score-10' onclick='toggleDiv(this)'>+155:                     L[halfbandwidth + indices[j,r,u] - indices[i,r,u], indices[i,r,u]] = Kij[j,i,r,u]</pre>
<pre class='cython code score-10'>          __pyx_t_100 = __pyx_v_j;
          __pyx_t_101 = __pyx_v_i;
          __pyx_t_102 = __pyx_v_r;
          __pyx_t_103 = __pyx_v_u;
          __pyx_t_104 = -1;
          if (__pyx_t_100 &lt; 0) {
            __pyx_t_100 += __pyx_pybuffernd_Kij.diminfo[0].shape;
            if (unlikely(__pyx_t_100 &lt; 0)) __pyx_t_104 = 0;
          } else if (unlikely(__pyx_t_100 &gt;= __pyx_pybuffernd_Kij.diminfo[0].shape)) __pyx_t_104 = 0;
          if (__pyx_t_101 &lt; 0) {
            __pyx_t_101 += __pyx_pybuffernd_Kij.diminfo[1].shape;
            if (unlikely(__pyx_t_101 &lt; 0)) __pyx_t_104 = 1;
          } else if (unlikely(__pyx_t_101 &gt;= __pyx_pybuffernd_Kij.diminfo[1].shape)) __pyx_t_104 = 1;
          if (__pyx_t_102 &lt; 0) {
            __pyx_t_102 += __pyx_pybuffernd_Kij.diminfo[2].shape;
            if (unlikely(__pyx_t_102 &lt; 0)) __pyx_t_104 = 2;
          } else if (unlikely(__pyx_t_102 &gt;= __pyx_pybuffernd_Kij.diminfo[2].shape)) __pyx_t_104 = 2;
          if (__pyx_t_103 &lt; 0) {
            __pyx_t_103 += __pyx_pybuffernd_Kij.diminfo[3].shape;
            if (unlikely(__pyx_t_103 &lt; 0)) __pyx_t_104 = 3;
          } else if (unlikely(__pyx_t_103 &gt;= __pyx_pybuffernd_Kij.diminfo[3].shape)) __pyx_t_104 = 3;
          if (unlikely(__pyx_t_104 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_104);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_104 = __pyx_v_j;
          __pyx_t_105 = __pyx_v_r;
          __pyx_t_106 = __pyx_v_u;
          __pyx_t_107 = -1;
          if (__pyx_t_104 &lt; 0) {
            __pyx_t_104 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_104 &lt; 0)) __pyx_t_107 = 0;
          } else if (unlikely(__pyx_t_104 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_107 = 0;
          if (__pyx_t_105 &lt; 0) {
            __pyx_t_105 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_105 &lt; 0)) __pyx_t_107 = 1;
          } else if (unlikely(__pyx_t_105 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_107 = 1;
          if (__pyx_t_106 &lt; 0) {
            __pyx_t_106 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_106 &lt; 0)) __pyx_t_107 = 2;
          } else if (unlikely(__pyx_t_106 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_107 = 2;
          if (unlikely(__pyx_t_107 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_107);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_107 = __pyx_v_i;
          __pyx_t_108 = __pyx_v_r;
          __pyx_t_109 = __pyx_v_u;
          __pyx_t_110 = -1;
          if (__pyx_t_107 &lt; 0) {
            __pyx_t_107 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_107 &lt; 0)) __pyx_t_110 = 0;
          } else if (unlikely(__pyx_t_107 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_110 = 0;
          if (__pyx_t_108 &lt; 0) {
            __pyx_t_108 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_108 &lt; 0)) __pyx_t_110 = 1;
          } else if (unlikely(__pyx_t_108 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_110 = 1;
          if (__pyx_t_109 &lt; 0) {
            __pyx_t_109 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_109 &lt; 0)) __pyx_t_110 = 2;
          } else if (unlikely(__pyx_t_109 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_110 = 2;
          if (unlikely(__pyx_t_110 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_110);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_110 = __pyx_v_i;
          __pyx_t_111 = __pyx_v_r;
          __pyx_t_112 = __pyx_v_u;
          __pyx_t_113 = -1;
          if (__pyx_t_110 &lt; 0) {
            __pyx_t_110 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_110 &lt; 0)) __pyx_t_113 = 0;
          } else if (unlikely(__pyx_t_110 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_113 = 0;
          if (__pyx_t_111 &lt; 0) {
            __pyx_t_111 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_111 &lt; 0)) __pyx_t_113 = 1;
          } else if (unlikely(__pyx_t_111 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_113 = 1;
          if (__pyx_t_112 &lt; 0) {
            __pyx_t_112 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_112 &lt; 0)) __pyx_t_113 = 2;
          } else if (unlikely(__pyx_t_112 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_113 = 2;
          if (unlikely(__pyx_t_113 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_113);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_95 = ((__pyx_v_halfbandwidth + (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_104, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_105, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_106, __pyx_pybuffernd_indices.diminfo[2].strides))) - (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_107, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_108, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_109, __pyx_pybuffernd_indices.diminfo[2].strides)));
          __pyx_t_98 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_110, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_111, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_112, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_113 = -1;
          if (__pyx_t_95 &lt; 0) {
            __pyx_t_95 += __pyx_pybuffernd_L.diminfo[0].shape;
            if (unlikely(__pyx_t_95 &lt; 0)) __pyx_t_113 = 0;
          } else if (unlikely(__pyx_t_95 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_113 = 0;
          if (__pyx_t_98 &lt; 0) {
            __pyx_t_98 += __pyx_pybuffernd_L.diminfo[1].shape;
            if (unlikely(__pyx_t_98 &lt; 0)) __pyx_t_113 = 1;
          } else if (unlikely(__pyx_t_98 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_113 = 1;
          if (unlikely(__pyx_t_113 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_113);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_95, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_98, __pyx_pybuffernd_L.diminfo[1].strides) = (*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.buf, __pyx_t_100, __pyx_pybuffernd_Kij.diminfo[0].strides, __pyx_t_101, __pyx_pybuffernd_Kij.diminfo[1].strides, __pyx_t_102, __pyx_pybuffernd_Kij.diminfo[2].strides, __pyx_t_103, __pyx_pybuffernd_Kij.diminfo[3].strides));
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+156:                     L[halfbandwidth, indices[i,r,u]] -= Kij[j,i,r,u]</pre>
<pre class='cython code score-6'>          __pyx_t_113 = __pyx_v_j;
          __pyx_t_114 = __pyx_v_i;
          __pyx_t_115 = __pyx_v_r;
          __pyx_t_116 = __pyx_v_u;
          __pyx_t_117 = -1;
          if (__pyx_t_113 &lt; 0) {
            __pyx_t_113 += __pyx_pybuffernd_Kij.diminfo[0].shape;
            if (unlikely(__pyx_t_113 &lt; 0)) __pyx_t_117 = 0;
          } else if (unlikely(__pyx_t_113 &gt;= __pyx_pybuffernd_Kij.diminfo[0].shape)) __pyx_t_117 = 0;
          if (__pyx_t_114 &lt; 0) {
            __pyx_t_114 += __pyx_pybuffernd_Kij.diminfo[1].shape;
            if (unlikely(__pyx_t_114 &lt; 0)) __pyx_t_117 = 1;
          } else if (unlikely(__pyx_t_114 &gt;= __pyx_pybuffernd_Kij.diminfo[1].shape)) __pyx_t_117 = 1;
          if (__pyx_t_115 &lt; 0) {
            __pyx_t_115 += __pyx_pybuffernd_Kij.diminfo[2].shape;
            if (unlikely(__pyx_t_115 &lt; 0)) __pyx_t_117 = 2;
          } else if (unlikely(__pyx_t_115 &gt;= __pyx_pybuffernd_Kij.diminfo[2].shape)) __pyx_t_117 = 2;
          if (__pyx_t_116 &lt; 0) {
            __pyx_t_116 += __pyx_pybuffernd_Kij.diminfo[3].shape;
            if (unlikely(__pyx_t_116 &lt; 0)) __pyx_t_117 = 3;
          } else if (unlikely(__pyx_t_116 &gt;= __pyx_pybuffernd_Kij.diminfo[3].shape)) __pyx_t_117 = 3;
          if (unlikely(__pyx_t_117 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_117);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_117 = __pyx_v_i;
          __pyx_t_118 = __pyx_v_r;
          __pyx_t_119 = __pyx_v_u;
          __pyx_t_120 = -1;
          if (__pyx_t_117 &lt; 0) {
            __pyx_t_117 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_117 &lt; 0)) __pyx_t_120 = 0;
          } else if (unlikely(__pyx_t_117 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_120 = 0;
          if (__pyx_t_118 &lt; 0) {
            __pyx_t_118 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_118 &lt; 0)) __pyx_t_120 = 1;
          } else if (unlikely(__pyx_t_118 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_120 = 1;
          if (__pyx_t_119 &lt; 0) {
            __pyx_t_119 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_119 &lt; 0)) __pyx_t_120 = 2;
          } else if (unlikely(__pyx_t_119 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_120 = 2;
          if (unlikely(__pyx_t_120 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_120);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_120 = __pyx_v_halfbandwidth;
          __pyx_t_121 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_117, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_118, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_119, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_122 = -1;
          if (__pyx_t_120 &lt; 0) {
            __pyx_t_120 += __pyx_pybuffernd_L.diminfo[0].shape;
            if (unlikely(__pyx_t_120 &lt; 0)) __pyx_t_122 = 0;
          } else if (unlikely(__pyx_t_120 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_122 = 0;
          if (__pyx_t_121 &lt; 0) {
            __pyx_t_121 += __pyx_pybuffernd_L.diminfo[1].shape;
            if (unlikely(__pyx_t_121 &lt; 0)) __pyx_t_122 = 1;
          } else if (unlikely(__pyx_t_121 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_122 = 1;
          if (unlikely(__pyx_t_122 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_122);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_120, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_121, __pyx_pybuffernd_L.diminfo[1].strides) -= (*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.buf, __pyx_t_113, __pyx_pybuffernd_Kij.diminfo[0].strides, __pyx_t_114, __pyx_pybuffernd_Kij.diminfo[1].strides, __pyx_t_115, __pyx_pybuffernd_Kij.diminfo[2].strides, __pyx_t_116, __pyx_pybuffernd_Kij.diminfo[3].strides));
</pre><pre class='cython line score-10' onclick='toggleDiv(this)'>+157:                     L[halfbandwidth + indices[i,r,u] - indices[j,r,u], indices[j,r,u]] = Kij[i,j,r,u]</pre>
<pre class='cython code score-10'>          __pyx_t_122 = __pyx_v_i;
          __pyx_t_123 = __pyx_v_j;
          __pyx_t_124 = __pyx_v_r;
          __pyx_t_125 = __pyx_v_u;
          __pyx_t_126 = -1;
          if (__pyx_t_122 &lt; 0) {
            __pyx_t_122 += __pyx_pybuffernd_Kij.diminfo[0].shape;
            if (unlikely(__pyx_t_122 &lt; 0)) __pyx_t_126 = 0;
          } else if (unlikely(__pyx_t_122 &gt;= __pyx_pybuffernd_Kij.diminfo[0].shape)) __pyx_t_126 = 0;
          if (__pyx_t_123 &lt; 0) {
            __pyx_t_123 += __pyx_pybuffernd_Kij.diminfo[1].shape;
            if (unlikely(__pyx_t_123 &lt; 0)) __pyx_t_126 = 1;
          } else if (unlikely(__pyx_t_123 &gt;= __pyx_pybuffernd_Kij.diminfo[1].shape)) __pyx_t_126 = 1;
          if (__pyx_t_124 &lt; 0) {
            __pyx_t_124 += __pyx_pybuffernd_Kij.diminfo[2].shape;
            if (unlikely(__pyx_t_124 &lt; 0)) __pyx_t_126 = 2;
          } else if (unlikely(__pyx_t_124 &gt;= __pyx_pybuffernd_Kij.diminfo[2].shape)) __pyx_t_126 = 2;
          if (__pyx_t_125 &lt; 0) {
            __pyx_t_125 += __pyx_pybuffernd_Kij.diminfo[3].shape;
            if (unlikely(__pyx_t_125 &lt; 0)) __pyx_t_126 = 3;
          } else if (unlikely(__pyx_t_125 &gt;= __pyx_pybuffernd_Kij.diminfo[3].shape)) __pyx_t_126 = 3;
          if (unlikely(__pyx_t_126 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_126);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_126 = __pyx_v_i;
          __pyx_t_127 = __pyx_v_r;
          __pyx_t_128 = __pyx_v_u;
          __pyx_t_129 = -1;
          if (__pyx_t_126 &lt; 0) {
            __pyx_t_126 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_126 &lt; 0)) __pyx_t_129 = 0;
          } else if (unlikely(__pyx_t_126 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_129 = 0;
          if (__pyx_t_127 &lt; 0) {
            __pyx_t_127 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_127 &lt; 0)) __pyx_t_129 = 1;
          } else if (unlikely(__pyx_t_127 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_129 = 1;
          if (__pyx_t_128 &lt; 0) {
            __pyx_t_128 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_128 &lt; 0)) __pyx_t_129 = 2;
          } else if (unlikely(__pyx_t_128 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_129 = 2;
          if (unlikely(__pyx_t_129 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_129);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_129 = __pyx_v_j;
          __pyx_t_130 = __pyx_v_r;
          __pyx_t_131 = __pyx_v_u;
          __pyx_t_132 = -1;
          if (__pyx_t_129 &lt; 0) {
            __pyx_t_129 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_129 &lt; 0)) __pyx_t_132 = 0;
          } else if (unlikely(__pyx_t_129 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_132 = 0;
          if (__pyx_t_130 &lt; 0) {
            __pyx_t_130 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_130 &lt; 0)) __pyx_t_132 = 1;
          } else if (unlikely(__pyx_t_130 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_132 = 1;
          if (__pyx_t_131 &lt; 0) {
            __pyx_t_131 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_131 &lt; 0)) __pyx_t_132 = 2;
          } else if (unlikely(__pyx_t_131 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_132 = 2;
          if (unlikely(__pyx_t_132 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_132);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_132 = __pyx_v_j;
          __pyx_t_133 = __pyx_v_r;
          __pyx_t_134 = __pyx_v_u;
          __pyx_t_135 = -1;
          if (__pyx_t_132 &lt; 0) {
            __pyx_t_132 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_132 &lt; 0)) __pyx_t_135 = 0;
          } else if (unlikely(__pyx_t_132 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_135 = 0;
          if (__pyx_t_133 &lt; 0) {
            __pyx_t_133 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_133 &lt; 0)) __pyx_t_135 = 1;
          } else if (unlikely(__pyx_t_133 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_135 = 1;
          if (__pyx_t_134 &lt; 0) {
            __pyx_t_134 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_134 &lt; 0)) __pyx_t_135 = 2;
          } else if (unlikely(__pyx_t_134 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_135 = 2;
          if (unlikely(__pyx_t_135 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_135);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_136 = ((__pyx_v_halfbandwidth + (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_126, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_127, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_128, __pyx_pybuffernd_indices.diminfo[2].strides))) - (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_129, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_130, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_131, __pyx_pybuffernd_indices.diminfo[2].strides)));
          __pyx_t_137 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_132, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_133, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_134, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_135 = -1;
          if (__pyx_t_136 &lt; 0) {
            __pyx_t_136 += __pyx_pybuffernd_L.diminfo[0].shape;
            if (unlikely(__pyx_t_136 &lt; 0)) __pyx_t_135 = 0;
          } else if (unlikely(__pyx_t_136 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_135 = 0;
          if (__pyx_t_137 &lt; 0) {
            __pyx_t_137 += __pyx_pybuffernd_L.diminfo[1].shape;
            if (unlikely(__pyx_t_137 &lt; 0)) __pyx_t_135 = 1;
          } else if (unlikely(__pyx_t_137 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_135 = 1;
          if (unlikely(__pyx_t_135 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_135);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_136, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_137, __pyx_pybuffernd_L.diminfo[1].strides) = (*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.buf, __pyx_t_122, __pyx_pybuffernd_Kij.diminfo[0].strides, __pyx_t_123, __pyx_pybuffernd_Kij.diminfo[1].strides, __pyx_t_124, __pyx_pybuffernd_Kij.diminfo[2].strides, __pyx_t_125, __pyx_pybuffernd_Kij.diminfo[3].strides));
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+158:                     L[halfbandwidth, indices[j,r,u]] -= Kij[i,j,r,u]</pre>
<pre class='cython code score-6'>          __pyx_t_135 = __pyx_v_i;
          __pyx_t_138 = __pyx_v_j;
          __pyx_t_139 = __pyx_v_r;
          __pyx_t_140 = __pyx_v_u;
          __pyx_t_141 = -1;
          if (__pyx_t_135 &lt; 0) {
            __pyx_t_135 += __pyx_pybuffernd_Kij.diminfo[0].shape;
            if (unlikely(__pyx_t_135 &lt; 0)) __pyx_t_141 = 0;
          } else if (unlikely(__pyx_t_135 &gt;= __pyx_pybuffernd_Kij.diminfo[0].shape)) __pyx_t_141 = 0;
          if (__pyx_t_138 &lt; 0) {
            __pyx_t_138 += __pyx_pybuffernd_Kij.diminfo[1].shape;
            if (unlikely(__pyx_t_138 &lt; 0)) __pyx_t_141 = 1;
          } else if (unlikely(__pyx_t_138 &gt;= __pyx_pybuffernd_Kij.diminfo[1].shape)) __pyx_t_141 = 1;
          if (__pyx_t_139 &lt; 0) {
            __pyx_t_139 += __pyx_pybuffernd_Kij.diminfo[2].shape;
            if (unlikely(__pyx_t_139 &lt; 0)) __pyx_t_141 = 2;
          } else if (unlikely(__pyx_t_139 &gt;= __pyx_pybuffernd_Kij.diminfo[2].shape)) __pyx_t_141 = 2;
          if (__pyx_t_140 &lt; 0) {
            __pyx_t_140 += __pyx_pybuffernd_Kij.diminfo[3].shape;
            if (unlikely(__pyx_t_140 &lt; 0)) __pyx_t_141 = 3;
          } else if (unlikely(__pyx_t_140 &gt;= __pyx_pybuffernd_Kij.diminfo[3].shape)) __pyx_t_141 = 3;
          if (unlikely(__pyx_t_141 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_141);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_141 = __pyx_v_j;
          __pyx_t_142 = __pyx_v_r;
          __pyx_t_143 = __pyx_v_u;
          __pyx_t_144 = -1;
          if (__pyx_t_141 &lt; 0) {
            __pyx_t_141 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_141 &lt; 0)) __pyx_t_144 = 0;
          } else if (unlikely(__pyx_t_141 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_144 = 0;
          if (__pyx_t_142 &lt; 0) {
            __pyx_t_142 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_142 &lt; 0)) __pyx_t_144 = 1;
          } else if (unlikely(__pyx_t_142 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_144 = 1;
          if (__pyx_t_143 &lt; 0) {
            __pyx_t_143 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_143 &lt; 0)) __pyx_t_144 = 2;
          } else if (unlikely(__pyx_t_143 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_144 = 2;
          if (unlikely(__pyx_t_144 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_144);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_144 = __pyx_v_halfbandwidth;
          __pyx_t_145 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_141, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_142, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_143, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_146 = -1;
          if (__pyx_t_144 &lt; 0) {
            __pyx_t_144 += __pyx_pybuffernd_L.diminfo[0].shape;
            if (unlikely(__pyx_t_144 &lt; 0)) __pyx_t_146 = 0;
          } else if (unlikely(__pyx_t_144 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_146 = 0;
          if (__pyx_t_145 &lt; 0) {
            __pyx_t_145 += __pyx_pybuffernd_L.diminfo[1].shape;
            if (unlikely(__pyx_t_145 &lt; 0)) __pyx_t_146 = 1;
          } else if (unlikely(__pyx_t_145 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_146 = 1;
          if (unlikely(__pyx_t_146 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_146);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_144, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_145, __pyx_pybuffernd_L.diminfo[1].strides) -= (*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Kij.rcbuffer-&gt;pybuffer.buf, __pyx_t_135, __pyx_pybuffernd_Kij.diminfo[0].strides, __pyx_t_138, __pyx_pybuffernd_Kij.diminfo[1].strides, __pyx_t_139, __pyx_pybuffernd_Kij.diminfo[2].strides, __pyx_t_140, __pyx_pybuffernd_Kij.diminfo[3].strides));
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;159:     # Dissociation/association terms</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+160:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+161:         for n in range(Nreac+Nprod):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = (__pyx_v_Nreac + __pyx_v_Nprod);
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_n = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+162:             for u in range(NJ):</pre>
<pre class='cython code score-0'>      __pyx_t_55 = __pyx_v_NJ;
      for (__pyx_t_57 = 0; __pyx_t_57 &lt; __pyx_t_55; __pyx_t_57+=1) {
        __pyx_v_u = __pyx_t_57;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+163:                 for r in range(Nres[i,u], Ngrains):</pre>
<pre class='cython code score-2'>        __pyx_t_58 = __pyx_v_Ngrains;
        __pyx_t_97 = __pyx_v_i;
        __pyx_t_146 = __pyx_v_u;
        __pyx_t_147 = -1;
        if (__pyx_t_97 &lt; 0) {
          __pyx_t_97 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_97 &lt; 0)) __pyx_t_147 = 0;
        } else if (unlikely(__pyx_t_97 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_147 = 0;
        if (__pyx_t_146 &lt; 0) {
          __pyx_t_146 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_146 &lt; 0)) __pyx_t_147 = 1;
        } else if (unlikely(__pyx_t_146 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_147 = 1;
        if (unlikely(__pyx_t_147 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_147);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        for (__pyx_t_147 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_97, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_146, __pyx_pybuffernd_Nres.diminfo[1].strides)); __pyx_t_147 &lt; __pyx_t_58; __pyx_t_147+=1) {
          __pyx_v_r = __pyx_t_147;
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+164:                     L[halfbandwidth, indices[i,r,u]] -= Gnj[n,i,r,u]</pre>
<pre class='cython code score-6'>          __pyx_t_148 = __pyx_v_n;
          __pyx_t_149 = __pyx_v_i;
          __pyx_t_150 = __pyx_v_r;
          __pyx_t_151 = __pyx_v_u;
          __pyx_t_152 = -1;
          if (__pyx_t_148 &lt; 0) {
            __pyx_t_148 += __pyx_pybuffernd_Gnj.diminfo[0].shape;
            if (unlikely(__pyx_t_148 &lt; 0)) __pyx_t_152 = 0;
          } else if (unlikely(__pyx_t_148 &gt;= __pyx_pybuffernd_Gnj.diminfo[0].shape)) __pyx_t_152 = 0;
          if (__pyx_t_149 &lt; 0) {
            __pyx_t_149 += __pyx_pybuffernd_Gnj.diminfo[1].shape;
            if (unlikely(__pyx_t_149 &lt; 0)) __pyx_t_152 = 1;
          } else if (unlikely(__pyx_t_149 &gt;= __pyx_pybuffernd_Gnj.diminfo[1].shape)) __pyx_t_152 = 1;
          if (__pyx_t_150 &lt; 0) {
            __pyx_t_150 += __pyx_pybuffernd_Gnj.diminfo[2].shape;
            if (unlikely(__pyx_t_150 &lt; 0)) __pyx_t_152 = 2;
          } else if (unlikely(__pyx_t_150 &gt;= __pyx_pybuffernd_Gnj.diminfo[2].shape)) __pyx_t_152 = 2;
          if (__pyx_t_151 &lt; 0) {
            __pyx_t_151 += __pyx_pybuffernd_Gnj.diminfo[3].shape;
            if (unlikely(__pyx_t_151 &lt; 0)) __pyx_t_152 = 3;
          } else if (unlikely(__pyx_t_151 &gt;= __pyx_pybuffernd_Gnj.diminfo[3].shape)) __pyx_t_152 = 3;
          if (unlikely(__pyx_t_152 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_152);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_152 = __pyx_v_i;
          __pyx_t_153 = __pyx_v_r;
          __pyx_t_154 = __pyx_v_u;
          __pyx_t_155 = -1;
          if (__pyx_t_152 &lt; 0) {
            __pyx_t_152 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_152 &lt; 0)) __pyx_t_155 = 0;
          } else if (unlikely(__pyx_t_152 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_155 = 0;
          if (__pyx_t_153 &lt; 0) {
            __pyx_t_153 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_153 &lt; 0)) __pyx_t_155 = 1;
          } else if (unlikely(__pyx_t_153 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_155 = 1;
          if (__pyx_t_154 &lt; 0) {
            __pyx_t_154 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_154 &lt; 0)) __pyx_t_155 = 2;
          } else if (unlikely(__pyx_t_154 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_155 = 2;
          if (unlikely(__pyx_t_155 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_155);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_155 = __pyx_v_halfbandwidth;
          __pyx_t_99 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_152, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_153, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_154, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_156 = -1;
          if (__pyx_t_155 &lt; 0) {
            __pyx_t_155 += __pyx_pybuffernd_L.diminfo[0].shape;
            if (unlikely(__pyx_t_155 &lt; 0)) __pyx_t_156 = 0;
          } else if (unlikely(__pyx_t_155 &gt;= __pyx_pybuffernd_L.diminfo[0].shape)) __pyx_t_156 = 0;
          if (__pyx_t_99 &lt; 0) {
            __pyx_t_99 += __pyx_pybuffernd_L.diminfo[1].shape;
            if (unlikely(__pyx_t_99 &lt; 0)) __pyx_t_156 = 1;
          } else if (unlikely(__pyx_t_99 &gt;= __pyx_pybuffernd_L.diminfo[1].shape)) __pyx_t_156 = 1;
          if (unlikely(__pyx_t_156 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_156);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_L.rcbuffer-&gt;pybuffer.buf, __pyx_t_155, __pyx_pybuffernd_L.diminfo[0].strides, __pyx_t_99, __pyx_pybuffernd_L.diminfo[1].strides) -= (*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Gnj.rcbuffer-&gt;pybuffer.buf, __pyx_t_148, __pyx_pybuffernd_Gnj.diminfo[0].strides, __pyx_t_149, __pyx_pybuffernd_Gnj.diminfo[1].strides, __pyx_t_150, __pyx_pybuffernd_Gnj.diminfo[2].strides, __pyx_t_151, __pyx_pybuffernd_Gnj.diminfo[3].strides));
        }
      }
    }
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+165:         for n in range(Nreac):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_Nreac;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_n = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+166:             for u in range(NJ):</pre>
<pre class='cython code score-0'>      __pyx_t_55 = __pyx_v_NJ;
      for (__pyx_t_57 = 0; __pyx_t_57 &lt; __pyx_t_55; __pyx_t_57+=1) {
        __pyx_v_u = __pyx_t_57;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+167:                 for r in range(Nres[i,u], Ngrains):</pre>
<pre class='cython code score-2'>        __pyx_t_58 = __pyx_v_Ngrains;
        __pyx_t_147 = __pyx_v_i;
        __pyx_t_156 = __pyx_v_u;
        __pyx_t_157 = -1;
        if (__pyx_t_147 &lt; 0) {
          __pyx_t_147 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_147 &lt; 0)) __pyx_t_157 = 0;
        } else if (unlikely(__pyx_t_147 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_157 = 0;
        if (__pyx_t_156 &lt; 0) {
          __pyx_t_156 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_156 &lt; 0)) __pyx_t_157 = 1;
        } else if (unlikely(__pyx_t_156 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_157 = 1;
        if (unlikely(__pyx_t_157 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_157);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        for (__pyx_t_157 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_147, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_156, __pyx_pybuffernd_Nres.diminfo[1].strides)); __pyx_t_157 &lt; __pyx_t_58; __pyx_t_157+=1) {
          __pyx_v_r = __pyx_t_157;
</pre><pre class='cython line score-8' onclick='toggleDiv(this)'>+168:                     Z[indices[i,r,u], n+Nisom] = Fim[i,n,r,u] * eqDist[n+Nisom,r,u]</pre>
<pre class='cython code score-8'>          __pyx_t_158 = __pyx_v_i;
          __pyx_t_159 = __pyx_v_n;
          __pyx_t_160 = __pyx_v_r;
          __pyx_t_161 = __pyx_v_u;
          __pyx_t_162 = -1;
          if (__pyx_t_158 &lt; 0) {
            __pyx_t_158 += __pyx_pybuffernd_Fim.diminfo[0].shape;
            if (unlikely(__pyx_t_158 &lt; 0)) __pyx_t_162 = 0;
          } else if (unlikely(__pyx_t_158 &gt;= __pyx_pybuffernd_Fim.diminfo[0].shape)) __pyx_t_162 = 0;
          if (__pyx_t_159 &lt; 0) {
            __pyx_t_159 += __pyx_pybuffernd_Fim.diminfo[1].shape;
            if (unlikely(__pyx_t_159 &lt; 0)) __pyx_t_162 = 1;
          } else if (unlikely(__pyx_t_159 &gt;= __pyx_pybuffernd_Fim.diminfo[1].shape)) __pyx_t_162 = 1;
          if (__pyx_t_160 &lt; 0) {
            __pyx_t_160 += __pyx_pybuffernd_Fim.diminfo[2].shape;
            if (unlikely(__pyx_t_160 &lt; 0)) __pyx_t_162 = 2;
          } else if (unlikely(__pyx_t_160 &gt;= __pyx_pybuffernd_Fim.diminfo[2].shape)) __pyx_t_162 = 2;
          if (__pyx_t_161 &lt; 0) {
            __pyx_t_161 += __pyx_pybuffernd_Fim.diminfo[3].shape;
            if (unlikely(__pyx_t_161 &lt; 0)) __pyx_t_162 = 3;
          } else if (unlikely(__pyx_t_161 &gt;= __pyx_pybuffernd_Fim.diminfo[3].shape)) __pyx_t_162 = 3;
          if (unlikely(__pyx_t_162 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_162);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_162 = (__pyx_v_n + __pyx_v_Nisom);
          __pyx_t_163 = __pyx_v_r;
          __pyx_t_164 = __pyx_v_u;
          __pyx_t_165 = -1;
          if (__pyx_t_162 &lt; 0) {
            __pyx_t_162 += __pyx_pybuffernd_eqDist.diminfo[0].shape;
            if (unlikely(__pyx_t_162 &lt; 0)) __pyx_t_165 = 0;
          } else if (unlikely(__pyx_t_162 &gt;= __pyx_pybuffernd_eqDist.diminfo[0].shape)) __pyx_t_165 = 0;
          if (__pyx_t_163 &lt; 0) {
            __pyx_t_163 += __pyx_pybuffernd_eqDist.diminfo[1].shape;
            if (unlikely(__pyx_t_163 &lt; 0)) __pyx_t_165 = 1;
          } else if (unlikely(__pyx_t_163 &gt;= __pyx_pybuffernd_eqDist.diminfo[1].shape)) __pyx_t_165 = 1;
          if (__pyx_t_164 &lt; 0) {
            __pyx_t_164 += __pyx_pybuffernd_eqDist.diminfo[2].shape;
            if (unlikely(__pyx_t_164 &lt; 0)) __pyx_t_165 = 2;
          } else if (unlikely(__pyx_t_164 &gt;= __pyx_pybuffernd_eqDist.diminfo[2].shape)) __pyx_t_165 = 2;
          if (unlikely(__pyx_t_165 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_165);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_165 = __pyx_v_i;
          __pyx_t_166 = __pyx_v_r;
          __pyx_t_167 = __pyx_v_u;
          __pyx_t_168 = -1;
          if (__pyx_t_165 &lt; 0) {
            __pyx_t_165 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_165 &lt; 0)) __pyx_t_168 = 0;
          } else if (unlikely(__pyx_t_165 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_168 = 0;
          if (__pyx_t_166 &lt; 0) {
            __pyx_t_166 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_166 &lt; 0)) __pyx_t_168 = 1;
          } else if (unlikely(__pyx_t_166 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_168 = 1;
          if (__pyx_t_167 &lt; 0) {
            __pyx_t_167 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_167 &lt; 0)) __pyx_t_168 = 2;
          } else if (unlikely(__pyx_t_167 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_168 = 2;
          if (unlikely(__pyx_t_168 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_168);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_169 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_165, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_166, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_167, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_168 = (__pyx_v_n + __pyx_v_Nisom);
          __pyx_t_170 = -1;
          if (__pyx_t_169 &lt; 0) {
            __pyx_t_169 += __pyx_pybuffernd_Z.diminfo[0].shape;
            if (unlikely(__pyx_t_169 &lt; 0)) __pyx_t_170 = 0;
          } else if (unlikely(__pyx_t_169 &gt;= __pyx_pybuffernd_Z.diminfo[0].shape)) __pyx_t_170 = 0;
          if (__pyx_t_168 &lt; 0) {
            __pyx_t_168 += __pyx_pybuffernd_Z.diminfo[1].shape;
            if (unlikely(__pyx_t_168 &lt; 0)) __pyx_t_170 = 1;
          } else if (unlikely(__pyx_t_168 &gt;= __pyx_pybuffernd_Z.diminfo[1].shape)) __pyx_t_170 = 1;
          if (unlikely(__pyx_t_170 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_170);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_169, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_168, __pyx_pybuffernd_Z.diminfo[1].strides) = ((*__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_Fim.rcbuffer-&gt;pybuffer.buf, __pyx_t_158, __pyx_pybuffernd_Fim.diminfo[0].strides, __pyx_t_159, __pyx_pybuffernd_Fim.diminfo[1].strides, __pyx_t_160, __pyx_pybuffernd_Fim.diminfo[2].strides, __pyx_t_161, __pyx_pybuffernd_Fim.diminfo[3].strides)) * (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.buf, __pyx_t_162, __pyx_pybuffernd_eqDist.diminfo[0].strides, __pyx_t_163, __pyx_pybuffernd_eqDist.diminfo[1].strides, __pyx_t_164, __pyx_pybuffernd_eqDist.diminfo[2].strides)));
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;169: </pre>
<pre class='cython line score-0'>&#xA0;170:     # Solve for pseudo-steady state populations of active state</pre>
<pre class='cython line score-73' onclick='toggleDiv(this)'>+171:     X = scipy.linalg.solve_banded((halfbandwidth,halfbandwidth), L, -Z, overwrite_ab=True, overwrite_b=True)</pre>
<pre class='cython code score-73'>  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_scipy);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_solve_banded);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_halfbandwidth);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_halfbandwidth);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_15 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Negative</span>(((PyObject *)__pyx_v_Z));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_L));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, ((PyObject *)__pyx_v_L));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_L));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 2, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_13 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_overwrite_ab, Py_True) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_overwrite_b, Py_True) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_15, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_13) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_13, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_13);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_7, &amp;__pyx_t_6, &amp;__pyx_t_5);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_X.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_X, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_6, __pyx_t_5);
      }
    }
    __pyx_pybuffernd_X.diminfo[0].strides = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_X.diminfo[0].shape = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_X.diminfo[1].strides = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_X.diminfo[1].shape = __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_18 = 0;
  __pyx_v_X = ((PyArrayObject *)__pyx_t_13);
  __pyx_t_13 = 0;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+172:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+173:         for u in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_u = __pyx_t_23;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+174:             for r in range(Nres[i,u], Ngrains):</pre>
<pre class='cython code score-2'>      __pyx_t_55 = __pyx_v_Ngrains;
      __pyx_t_57 = __pyx_v_i;
      __pyx_t_58 = __pyx_v_u;
      __pyx_t_157 = -1;
      if (__pyx_t_57 &lt; 0) {
        __pyx_t_57 += __pyx_pybuffernd_Nres.diminfo[0].shape;
        if (unlikely(__pyx_t_57 &lt; 0)) __pyx_t_157 = 0;
      } else if (unlikely(__pyx_t_57 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_157 = 0;
      if (__pyx_t_58 &lt; 0) {
        __pyx_t_58 += __pyx_pybuffernd_Nres.diminfo[1].shape;
        if (unlikely(__pyx_t_58 &lt; 0)) __pyx_t_157 = 1;
      } else if (unlikely(__pyx_t_58 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_157 = 1;
      if (unlikely(__pyx_t_157 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_157);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      for (__pyx_t_157 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_57, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_58, __pyx_pybuffernd_Nres.diminfo[1].strides)); __pyx_t_157 &lt; __pyx_t_55; __pyx_t_157+=1) {
        __pyx_v_r = __pyx_t_157;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+175:                 for n in range(Nisom+Nreac):</pre>
<pre class='cython code score-0'>        __pyx_t_170 = (__pyx_v_Nisom + __pyx_v_Nreac);
        for (__pyx_t_171 = 0; __pyx_t_171 &lt; __pyx_t_170; __pyx_t_171+=1) {
          __pyx_v_n = __pyx_t_171;
</pre><pre class='cython line score-6' onclick='toggleDiv(this)'>+176:                     pa[i,n,r,u] = X[indices[i,r,u], n]</pre>
<pre class='cython code score-6'>          __pyx_t_172 = __pyx_v_i;
          __pyx_t_173 = __pyx_v_r;
          __pyx_t_174 = __pyx_v_u;
          __pyx_t_175 = -1;
          if (__pyx_t_172 &lt; 0) {
            __pyx_t_172 += __pyx_pybuffernd_indices.diminfo[0].shape;
            if (unlikely(__pyx_t_172 &lt; 0)) __pyx_t_175 = 0;
          } else if (unlikely(__pyx_t_172 &gt;= __pyx_pybuffernd_indices.diminfo[0].shape)) __pyx_t_175 = 0;
          if (__pyx_t_173 &lt; 0) {
            __pyx_t_173 += __pyx_pybuffernd_indices.diminfo[1].shape;
            if (unlikely(__pyx_t_173 &lt; 0)) __pyx_t_175 = 1;
          } else if (unlikely(__pyx_t_173 &gt;= __pyx_pybuffernd_indices.diminfo[1].shape)) __pyx_t_175 = 1;
          if (__pyx_t_174 &lt; 0) {
            __pyx_t_174 += __pyx_pybuffernd_indices.diminfo[2].shape;
            if (unlikely(__pyx_t_174 &lt; 0)) __pyx_t_175 = 2;
          } else if (unlikely(__pyx_t_174 &gt;= __pyx_pybuffernd_indices.diminfo[2].shape)) __pyx_t_175 = 2;
          if (unlikely(__pyx_t_175 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_175);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_176 = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_indices.rcbuffer-&gt;pybuffer.buf, __pyx_t_172, __pyx_pybuffernd_indices.diminfo[0].strides, __pyx_t_173, __pyx_pybuffernd_indices.diminfo[1].strides, __pyx_t_174, __pyx_pybuffernd_indices.diminfo[2].strides));
          __pyx_t_175 = __pyx_v_n;
          __pyx_t_177 = -1;
          if (__pyx_t_176 &lt; 0) {
            __pyx_t_176 += __pyx_pybuffernd_X.diminfo[0].shape;
            if (unlikely(__pyx_t_176 &lt; 0)) __pyx_t_177 = 0;
          } else if (unlikely(__pyx_t_176 &gt;= __pyx_pybuffernd_X.diminfo[0].shape)) __pyx_t_177 = 0;
          if (__pyx_t_175 &lt; 0) {
            __pyx_t_175 += __pyx_pybuffernd_X.diminfo[1].shape;
            if (unlikely(__pyx_t_175 &lt; 0)) __pyx_t_177 = 1;
          } else if (unlikely(__pyx_t_175 &gt;= __pyx_pybuffernd_X.diminfo[1].shape)) __pyx_t_177 = 1;
          if (unlikely(__pyx_t_177 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_177);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_177 = __pyx_v_i;
          __pyx_t_178 = __pyx_v_n;
          __pyx_t_179 = __pyx_v_r;
          __pyx_t_180 = __pyx_v_u;
          __pyx_t_181 = -1;
          if (__pyx_t_177 &lt; 0) {
            __pyx_t_177 += __pyx_pybuffernd_pa.diminfo[0].shape;
            if (unlikely(__pyx_t_177 &lt; 0)) __pyx_t_181 = 0;
          } else if (unlikely(__pyx_t_177 &gt;= __pyx_pybuffernd_pa.diminfo[0].shape)) __pyx_t_181 = 0;
          if (__pyx_t_178 &lt; 0) {
            __pyx_t_178 += __pyx_pybuffernd_pa.diminfo[1].shape;
            if (unlikely(__pyx_t_178 &lt; 0)) __pyx_t_181 = 1;
          } else if (unlikely(__pyx_t_178 &gt;= __pyx_pybuffernd_pa.diminfo[1].shape)) __pyx_t_181 = 1;
          if (__pyx_t_179 &lt; 0) {
            __pyx_t_179 += __pyx_pybuffernd_pa.diminfo[2].shape;
            if (unlikely(__pyx_t_179 &lt; 0)) __pyx_t_181 = 2;
          } else if (unlikely(__pyx_t_179 &gt;= __pyx_pybuffernd_pa.diminfo[2].shape)) __pyx_t_181 = 2;
          if (__pyx_t_180 &lt; 0) {
            __pyx_t_180 += __pyx_pybuffernd_pa.diminfo[3].shape;
            if (unlikely(__pyx_t_180 &lt; 0)) __pyx_t_181 = 3;
          } else if (unlikely(__pyx_t_180 &gt;= __pyx_pybuffernd_pa.diminfo[3].shape)) __pyx_t_181 = 3;
          if (unlikely(__pyx_t_181 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_181);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.buf, __pyx_t_177, __pyx_pybuffernd_pa.diminfo[0].strides, __pyx_t_178, __pyx_pybuffernd_pa.diminfo[1].strides, __pyx_t_179, __pyx_pybuffernd_pa.diminfo[2].strides, __pyx_t_180, __pyx_pybuffernd_pa.diminfo[3].strides) = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_X.rcbuffer-&gt;pybuffer.buf, __pyx_t_176, __pyx_pybuffernd_X.diminfo[0].strides, __pyx_t_175, __pyx_pybuffernd_X.diminfo[1].strides));
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;177: </pre>
<pre class='cython line score-0'>&#xA0;178:     # Double-check to ensure that we have all positive populations</pre>
<pre class='cython line score-27' onclick='toggleDiv(this)'>+179:     if not (pa &gt;= 0).all():</pre>
<pre class='cython code score-27'>  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_pa), __pyx_int_0, Py_GE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_all);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_15, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_13);<span class='error_goto'> if (unlikely(__pyx_t_26 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_31 = ((!__pyx_t_26) != 0);
  if (__pyx_t_31) {
</pre><pre class='cython line score-13' onclick='toggleDiv(this)'>+180:         raise ReservoirStateError('A negative steady-state population was encountered.')</pre>
<pre class='cython code score-13'>    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_ReservoirStateError);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_15, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_A_negative_steady_state_populati);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
</pre><pre class='cython line score-0'>&#xA0;181: </pre>
<pre class='cython line score-0'>&#xA0;182:     # Put the reservoir populations into pa as well</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+183:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+184:         for u in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_u = __pyx_t_23;
</pre><pre class='cython line score-2' onclick='toggleDiv(this)'>+185:             for r in range(Nres[i,u]):</pre>
<pre class='cython code score-2'>      __pyx_t_55 = __pyx_v_i;
      __pyx_t_157 = __pyx_v_u;
      __pyx_t_170 = -1;
      if (__pyx_t_55 &lt; 0) {
        __pyx_t_55 += __pyx_pybuffernd_Nres.diminfo[0].shape;
        if (unlikely(__pyx_t_55 &lt; 0)) __pyx_t_170 = 0;
      } else if (unlikely(__pyx_t_55 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_170 = 0;
      if (__pyx_t_157 &lt; 0) {
        __pyx_t_157 += __pyx_pybuffernd_Nres.diminfo[1].shape;
        if (unlikely(__pyx_t_157 &lt; 0)) __pyx_t_170 = 1;
      } else if (unlikely(__pyx_t_157 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_170 = 1;
      if (unlikely(__pyx_t_170 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_170);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_182 = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_55, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_157, __pyx_pybuffernd_Nres.diminfo[1].strides));
      for (__pyx_t_170 = 0; __pyx_t_170 &lt; __pyx_t_182; __pyx_t_170+=1) {
        __pyx_v_r = __pyx_t_170;
</pre><pre class='cython line score-4' onclick='toggleDiv(this)'>+186:                 pa[i,i,r,u] = eqDist[i,r,u]</pre>
<pre class='cython code score-4'>        __pyx_t_171 = __pyx_v_i;
        __pyx_t_181 = __pyx_v_r;
        __pyx_t_183 = __pyx_v_u;
        __pyx_t_184 = -1;
        if (__pyx_t_171 &lt; 0) {
          __pyx_t_171 += __pyx_pybuffernd_eqDist.diminfo[0].shape;
          if (unlikely(__pyx_t_171 &lt; 0)) __pyx_t_184 = 0;
        } else if (unlikely(__pyx_t_171 &gt;= __pyx_pybuffernd_eqDist.diminfo[0].shape)) __pyx_t_184 = 0;
        if (__pyx_t_181 &lt; 0) {
          __pyx_t_181 += __pyx_pybuffernd_eqDist.diminfo[1].shape;
          if (unlikely(__pyx_t_181 &lt; 0)) __pyx_t_184 = 1;
        } else if (unlikely(__pyx_t_181 &gt;= __pyx_pybuffernd_eqDist.diminfo[1].shape)) __pyx_t_184 = 1;
        if (__pyx_t_183 &lt; 0) {
          __pyx_t_183 += __pyx_pybuffernd_eqDist.diminfo[2].shape;
          if (unlikely(__pyx_t_183 &lt; 0)) __pyx_t_184 = 2;
        } else if (unlikely(__pyx_t_183 &gt;= __pyx_pybuffernd_eqDist.diminfo[2].shape)) __pyx_t_184 = 2;
        if (unlikely(__pyx_t_184 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_184);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_184 = __pyx_v_i;
        __pyx_t_185 = __pyx_v_i;
        __pyx_t_186 = __pyx_v_r;
        __pyx_t_187 = __pyx_v_u;
        __pyx_t_188 = -1;
        if (__pyx_t_184 &lt; 0) {
          __pyx_t_184 += __pyx_pybuffernd_pa.diminfo[0].shape;
          if (unlikely(__pyx_t_184 &lt; 0)) __pyx_t_188 = 0;
        } else if (unlikely(__pyx_t_184 &gt;= __pyx_pybuffernd_pa.diminfo[0].shape)) __pyx_t_188 = 0;
        if (__pyx_t_185 &lt; 0) {
          __pyx_t_185 += __pyx_pybuffernd_pa.diminfo[1].shape;
          if (unlikely(__pyx_t_185 &lt; 0)) __pyx_t_188 = 1;
        } else if (unlikely(__pyx_t_185 &gt;= __pyx_pybuffernd_pa.diminfo[1].shape)) __pyx_t_188 = 1;
        if (__pyx_t_186 &lt; 0) {
          __pyx_t_186 += __pyx_pybuffernd_pa.diminfo[2].shape;
          if (unlikely(__pyx_t_186 &lt; 0)) __pyx_t_188 = 2;
        } else if (unlikely(__pyx_t_186 &gt;= __pyx_pybuffernd_pa.diminfo[2].shape)) __pyx_t_188 = 2;
        if (__pyx_t_187 &lt; 0) {
          __pyx_t_187 += __pyx_pybuffernd_pa.diminfo[3].shape;
          if (unlikely(__pyx_t_187 &lt; 0)) __pyx_t_188 = 3;
        } else if (unlikely(__pyx_t_187 &gt;= __pyx_pybuffernd_pa.diminfo[3].shape)) __pyx_t_188 = 3;
        if (unlikely(__pyx_t_188 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_188);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided4d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_pa.rcbuffer-&gt;pybuffer.buf, __pyx_t_184, __pyx_pybuffernd_pa.diminfo[0].strides, __pyx_t_185, __pyx_pybuffernd_pa.diminfo[1].strides, __pyx_t_186, __pyx_pybuffernd_pa.diminfo[2].strides, __pyx_t_187, __pyx_pybuffernd_pa.diminfo[3].strides) = (*__Pyx_BufPtrStrided3d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_eqDist.rcbuffer-&gt;pybuffer.buf, __pyx_t_171, __pyx_pybuffernd_eqDist.diminfo[0].strides, __pyx_t_181, __pyx_pybuffernd_eqDist.diminfo[1].strides, __pyx_t_183, __pyx_pybuffernd_eqDist.diminfo[2].strides));
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;187: </pre>
<pre class='cython line score-0'>&#xA0;188:     # Determine the phenomenological rate coefficients using the general procedure</pre>
<pre class='cython line score-0'>&#xA0;189:     # This should be exactly the same as the procedure below, which is more</pre>
<pre class='cython line score-0'>&#xA0;190:     # specific to the RS method</pre>
<pre class='cython line score-0'>&#xA0;191:     # Previously it was noted that this more general approach was more robust;</pre>
<pre class='cython line score-0'>&#xA0;192:     # however, more recently it seems that this is no longer the case</pre>
<pre class='cython line score-0'>&#xA0;193:     #K = computeRateCoefficients(Mcoll, Kij, Fim, Gnj, pa, Nisom, Nreac, Nprod)</pre>
<pre class='cython line score-0'>&#xA0;194: </pre>
<pre class='cython line score-0'>&#xA0;195:     # Determine the phenomenological rate coefficients</pre>
<pre class='cython line score-64' onclick='toggleDiv(this)'>+196:     K = numpy.zeros((Nisom+Nreac+Nprod, Nisom+Nreac+Nprod), numpy.float64)</pre>
<pre class='cython code score-64'>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((__pyx_v_Nisom + __pyx_v_Nreac) + __pyx_v_Nprod));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((__pyx_v_Nisom + __pyx_v_Nreac) + __pyx_v_Nprod));<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  __pyx_t_13 = 0;
  __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = NULL;
  __pyx_t_16 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_17)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_16 = 1;
    }
  }
  __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  if (__pyx_t_17) {
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
  }
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_16, __pyx_t_12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_16, __pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
  __pyx_t_12 = 0;
  __pyx_t_13 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_15) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_15, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_15);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_4 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_5, &amp;__pyx_t_6, &amp;__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_K.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_K, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      }
    }
    __pyx_pybuffernd_K.diminfo[0].strides = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_K.diminfo[0].shape = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_K.diminfo[1].strides = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_K.diminfo[1].shape = __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_18 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_K, ((PyArrayObject *)__pyx_t_15));
  __pyx_t_15 = 0;
</pre><pre class='cython line score-0'>&#xA0;197:     # Rows relating to isomers</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+198:     for i in range(Nisom):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nisom;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+199:         for u in range(NJ):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_NJ;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_u = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+200:             for v in range(NJ):</pre>
<pre class='cython code score-0'>      __pyx_t_170 = __pyx_v_NJ;
      for (__pyx_t_188 = 0; __pyx_t_188 &lt; __pyx_t_170; __pyx_t_188+=1) {
        __pyx_v_v = __pyx_t_188;
</pre><pre class='cython line score-0'>&#xA0;201:                 # Collisional rearrangement within the reservoir of isomer i</pre>
<pre class='cython line score-148' onclick='toggleDiv(this)'>+202:                 K[i,i] = K[i,i] + numpy.sum(numpy.dot(Mcoll[i,0:Nres[i,u],u,0:Nres[i,v],v], eqDist[i,0:Nres[i,v],v]))</pre>
<pre class='cython code score-148'>        __pyx_t_189 = __pyx_v_i;
        __pyx_t_190 = __pyx_v_i;
        __pyx_t_191 = -1;
        if (__pyx_t_189 &lt; 0) {
          __pyx_t_189 += __pyx_pybuffernd_K.diminfo[0].shape;
          if (unlikely(__pyx_t_189 &lt; 0)) __pyx_t_191 = 0;
        } else if (unlikely(__pyx_t_189 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_191 = 0;
        if (__pyx_t_190 &lt; 0) {
          __pyx_t_190 += __pyx_pybuffernd_K.diminfo[1].shape;
          if (unlikely(__pyx_t_190 &lt; 0)) __pyx_t_191 = 1;
        } else if (unlikely(__pyx_t_190 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_191 = 1;
        if (unlikely(__pyx_t_191 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_191);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_189, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_190, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_191 = __pyx_v_i;
        __pyx_t_192 = __pyx_v_u;
        __pyx_t_193 = -1;
        if (__pyx_t_191 &lt; 0) {
          __pyx_t_191 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_191 &lt; 0)) __pyx_t_193 = 0;
        } else if (unlikely(__pyx_t_191 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_193 = 0;
        if (__pyx_t_192 &lt; 0) {
          __pyx_t_192 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_192 &lt; 0)) __pyx_t_193 = 1;
        } else if (unlikely(__pyx_t_192 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_193 = 1;
        if (unlikely(__pyx_t_193 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_193);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_191, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_192, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
        __pyx_t_19 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_86, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
        __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
        __pyx_t_193 = __pyx_v_i;
        __pyx_t_194 = __pyx_v_v;
        __pyx_t_195 = -1;
        if (__pyx_t_193 &lt; 0) {
          __pyx_t_193 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_193 &lt; 0)) __pyx_t_195 = 0;
        } else if (unlikely(__pyx_t_193 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_195 = 0;
        if (__pyx_t_194 &lt; 0) {
          __pyx_t_194 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_194 &lt; 0)) __pyx_t_195 = 1;
        } else if (unlikely(__pyx_t_194 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_195 = 1;
        if (unlikely(__pyx_t_195 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_195);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_193, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_194, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
        __pyx_t_197 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_196, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
        __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
        __pyx_t_198 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 0, __pyx_t_12);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 1, __pyx_t_19);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 2, __pyx_t_86);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 3, __pyx_t_197);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 4, __pyx_t_196);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
        __pyx_t_12 = 0;
        __pyx_t_19 = 0;
        __pyx_t_86 = 0;
        __pyx_t_197 = 0;
        __pyx_t_196 = 0;
        __pyx_t_196 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Mcoll), __pyx_t_198);<span class='error_goto'> if (unlikely(__pyx_t_196 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
        __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
        __pyx_t_195 = __pyx_v_i;
        __pyx_t_199 = __pyx_v_v;
        __pyx_t_200 = -1;
        if (__pyx_t_195 &lt; 0) {
          __pyx_t_195 += __pyx_pybuffernd_Nres.diminfo[0].shape;
          if (unlikely(__pyx_t_195 &lt; 0)) __pyx_t_200 = 0;
        } else if (unlikely(__pyx_t_195 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_200 = 0;
        if (__pyx_t_199 &lt; 0) {
          __pyx_t_199 += __pyx_pybuffernd_Nres.diminfo[1].shape;
          if (unlikely(__pyx_t_199 &lt; 0)) __pyx_t_200 = 1;
        } else if (unlikely(__pyx_t_199 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_200 = 1;
        if (unlikely(__pyx_t_200 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_200);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_195, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_199, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
        __pyx_t_86 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_197, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
        __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
        __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_198);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_86);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_197);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197);
        __pyx_t_198 = 0;
        __pyx_t_86 = 0;
        __pyx_t_197 = 0;
        __pyx_t_197 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_eqDist), __pyx_t_19);<span class='error_goto'> if (unlikely(__pyx_t_197 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
        __pyx_t_19 = NULL;
        __pyx_t_16 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
          __pyx_t_19 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
          if (likely(__pyx_t_19)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_19);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
            __pyx_t_16 = 1;
          }
        }
        __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
        if (__pyx_t_19) {
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_19); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19); __pyx_t_19 = NULL;
        }
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0+__pyx_t_16, __pyx_t_196);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1+__pyx_t_16, __pyx_t_197);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197);
        __pyx_t_196 = 0;
        __pyx_t_197 = 0;
        __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_86, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        __pyx_t_17 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
          __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
          if (likely(__pyx_t_17)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
          }
        }
        if (!__pyx_t_17) {
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        } else {
          __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0+1, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          __pyx_t_14 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_86, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_15, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_200 = __pyx_v_i;
        __pyx_t_201 = __pyx_v_i;
        __pyx_t_202 = -1;
        if (__pyx_t_200 &lt; 0) {
          __pyx_t_200 += __pyx_pybuffernd_K.diminfo[0].shape;
          if (unlikely(__pyx_t_200 &lt; 0)) __pyx_t_202 = 0;
        } else if (unlikely(__pyx_t_200 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_202 = 0;
        if (__pyx_t_201 &lt; 0) {
          __pyx_t_201 += __pyx_pybuffernd_K.diminfo[1].shape;
          if (unlikely(__pyx_t_201 &lt; 0)) __pyx_t_202 = 1;
        } else if (unlikely(__pyx_t_201 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_202 = 1;
        if (unlikely(__pyx_t_202 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_202);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_200, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_201, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
</pre><pre class='cython line score-0'>&#xA0;203:                 # Isomerization from isomer j to isomer i</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+204:                 for j in range(Nisom):</pre>
<pre class='cython code score-0'>        __pyx_t_202 = __pyx_v_Nisom;
        for (__pyx_t_203 = 0; __pyx_t_203 &lt; __pyx_t_202; __pyx_t_203+=1) {
          __pyx_v_j = __pyx_t_203;
</pre><pre class='cython line score-157' onclick='toggleDiv(this)'>+205:                     K[i,j] = K[i,j] + numpy.sum(numpy.dot(Mcoll[i,0:Nres[i,u],u,Nres[i,v]:Ngrains,v], pa[i,j,Nres[i,v]:Ngrains,v]))</pre>
<pre class='cython code score-157'>          __pyx_t_204 = __pyx_v_i;
          __pyx_t_205 = __pyx_v_j;
          __pyx_t_206 = -1;
          if (__pyx_t_204 &lt; 0) {
            __pyx_t_204 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_204 &lt; 0)) __pyx_t_206 = 0;
          } else if (unlikely(__pyx_t_204 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_206 = 0;
          if (__pyx_t_205 &lt; 0) {
            __pyx_t_205 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_205 &lt; 0)) __pyx_t_206 = 1;
          } else if (unlikely(__pyx_t_205 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_206 = 1;
          if (unlikely(__pyx_t_206 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_206);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_13 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_204, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_205, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_206 = __pyx_v_i;
          __pyx_t_207 = __pyx_v_u;
          __pyx_t_208 = -1;
          if (__pyx_t_206 &lt; 0) {
            __pyx_t_206 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_206 &lt; 0)) __pyx_t_208 = 0;
          } else if (unlikely(__pyx_t_206 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_208 = 0;
          if (__pyx_t_207 &lt; 0) {
            __pyx_t_207 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_207 &lt; 0)) __pyx_t_208 = 1;
          } else if (unlikely(__pyx_t_207 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_208 = 1;
          if (unlikely(__pyx_t_208 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_208);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_206, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_207, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          __pyx_t_196 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_197, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
          __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          __pyx_t_208 = __pyx_v_i;
          __pyx_t_209 = __pyx_v_v;
          __pyx_t_210 = -1;
          if (__pyx_t_208 &lt; 0) {
            __pyx_t_208 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_208 &lt; 0)) __pyx_t_210 = 0;
          } else if (unlikely(__pyx_t_208 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_210 = 0;
          if (__pyx_t_209 &lt; 0) {
            __pyx_t_209 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_209 &lt; 0)) __pyx_t_210 = 1;
          } else if (unlikely(__pyx_t_209 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_210 = 1;
          if (unlikely(__pyx_t_210 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_210);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_208, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_209, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_12 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_19, __pyx_t_198, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 2, __pyx_t_197);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 3, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 4, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          __pyx_t_14 = 0;
          __pyx_t_196 = 0;
          __pyx_t_197 = 0;
          __pyx_t_12 = 0;
          __pyx_t_198 = 0;
          __pyx_t_198 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Mcoll), __pyx_t_19);<span class='error_goto'> if (unlikely(__pyx_t_198 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_210 = __pyx_v_i;
          __pyx_t_211 = __pyx_v_v;
          __pyx_t_212 = -1;
          if (__pyx_t_210 &lt; 0) {
            __pyx_t_210 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_210 &lt; 0)) __pyx_t_212 = 0;
          } else if (unlikely(__pyx_t_210 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_212 = 0;
          if (__pyx_t_211 &lt; 0) {
            __pyx_t_211 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_211 &lt; 0)) __pyx_t_212 = 1;
          } else if (unlikely(__pyx_t_211 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_212 = 1;
          if (unlikely(__pyx_t_212 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_212);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_210, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_211, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_14 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_197, __pyx_t_196, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_197 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 0, __pyx_t_19);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 1, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 2, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 3, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          __pyx_t_19 = 0;
          __pyx_t_12 = 0;
          __pyx_t_14 = 0;
          __pyx_t_196 = 0;
          __pyx_t_196 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_pa), __pyx_t_197);<span class='error_goto'> if (unlikely(__pyx_t_196 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
          __pyx_t_197 = NULL;
          __pyx_t_16 = 0;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
            __pyx_t_197 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
            if (likely(__pyx_t_197)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_197);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
              __pyx_t_16 = 1;
            }
          }
          __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          if (__pyx_t_197) {
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_197); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197); __pyx_t_197 = NULL;
          }
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_16, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_16, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          __pyx_t_198 = 0;
          __pyx_t_196 = 0;
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_t_17 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_86))) {
            __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_86);
            if (likely(__pyx_t_17)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_86);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_86, function);
            }
          }
          if (!__pyx_t_17) {
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_86, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else {
            __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+1, __pyx_t_15);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
            __pyx_t_15 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_86, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          __pyx_t_86 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_13, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_86);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          __pyx_t_212 = __pyx_v_i;
          __pyx_t_213 = __pyx_v_j;
          __pyx_t_214 = -1;
          if (__pyx_t_212 &lt; 0) {
            __pyx_t_212 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_212 &lt; 0)) __pyx_t_214 = 0;
          } else if (unlikely(__pyx_t_212 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_214 = 0;
          if (__pyx_t_213 &lt; 0) {
            __pyx_t_213 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_213 &lt; 0)) __pyx_t_214 = 1;
          } else if (unlikely(__pyx_t_213 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_214 = 1;
          if (unlikely(__pyx_t_214 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_214);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_212, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_213, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
        }
</pre><pre class='cython line score-0'>&#xA0;206:                 # Association from reactant n to isomer i</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+207:                 for n in range(Nisom, Nisom+Nreac):</pre>
<pre class='cython code score-0'>        __pyx_t_202 = (__pyx_v_Nisom + __pyx_v_Nreac);
        for (__pyx_t_203 = __pyx_v_Nisom; __pyx_t_203 &lt; __pyx_t_202; __pyx_t_203+=1) {
          __pyx_v_n = __pyx_t_203;
</pre><pre class='cython line score-157' onclick='toggleDiv(this)'>+208:                     K[i,n] = K[i,n] + numpy.sum(numpy.dot(Mcoll[i,0:Nres[i,u],u,Nres[i,v]:Ngrains,v], pa[i,n,Nres[i,v]:Ngrains,v]))</pre>
<pre class='cython code score-157'>          __pyx_t_214 = __pyx_v_i;
          __pyx_t_215 = __pyx_v_n;
          __pyx_t_216 = -1;
          if (__pyx_t_214 &lt; 0) {
            __pyx_t_214 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_214 &lt; 0)) __pyx_t_216 = 0;
          } else if (unlikely(__pyx_t_214 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_216 = 0;
          if (__pyx_t_215 &lt; 0) {
            __pyx_t_215 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_215 &lt; 0)) __pyx_t_216 = 1;
          } else if (unlikely(__pyx_t_215 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_216 = 1;
          if (unlikely(__pyx_t_216 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_216);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_86 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_214, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_215, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_216 = __pyx_v_i;
          __pyx_t_217 = __pyx_v_u;
          __pyx_t_218 = -1;
          if (__pyx_t_216 &lt; 0) {
            __pyx_t_216 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_216 &lt; 0)) __pyx_t_218 = 0;
          } else if (unlikely(__pyx_t_216 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_218 = 0;
          if (__pyx_t_217 &lt; 0) {
            __pyx_t_217 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_217 &lt; 0)) __pyx_t_218 = 1;
          } else if (unlikely(__pyx_t_217 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_218 = 1;
          if (unlikely(__pyx_t_218 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_218);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_216, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_217, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_198 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_196, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_218 = __pyx_v_i;
          __pyx_t_219 = __pyx_v_v;
          __pyx_t_220 = -1;
          if (__pyx_t_218 &lt; 0) {
            __pyx_t_218 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_218 &lt; 0)) __pyx_t_220 = 0;
          } else if (unlikely(__pyx_t_218 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_220 = 0;
          if (__pyx_t_219 &lt; 0) {
            __pyx_t_219 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_219 &lt; 0)) __pyx_t_220 = 1;
          } else if (unlikely(__pyx_t_219 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_220 = 1;
          if (unlikely(__pyx_t_220 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_220);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_218, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_219, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_19 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_197, __pyx_t_12, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_197 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 0, __pyx_t_15);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 1, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 2, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 3, __pyx_t_19);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_197, 4, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          __pyx_t_15 = 0;
          __pyx_t_198 = 0;
          __pyx_t_196 = 0;
          __pyx_t_19 = 0;
          __pyx_t_12 = 0;
          __pyx_t_12 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Mcoll), __pyx_t_197);<span class='error_goto'> if (unlikely(__pyx_t_12 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_197); __pyx_t_197 = 0;
          __pyx_t_197 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_197)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_197);
          __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          __pyx_t_220 = __pyx_v_i;
          __pyx_t_221 = __pyx_v_v;
          __pyx_t_222 = -1;
          if (__pyx_t_220 &lt; 0) {
            __pyx_t_220 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_220 &lt; 0)) __pyx_t_222 = 0;
          } else if (unlikely(__pyx_t_220 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_222 = 0;
          if (__pyx_t_221 &lt; 0) {
            __pyx_t_221 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_221 &lt; 0)) __pyx_t_222 = 1;
          } else if (unlikely(__pyx_t_221 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_222 = 1;
          if (unlikely(__pyx_t_222 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_222);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_220, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_221, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_15 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_196, __pyx_t_198, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_v);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_196 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 0, __pyx_t_197);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_197);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 1, __pyx_t_19);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 2, __pyx_t_15);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 3, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          __pyx_t_197 = 0;
          __pyx_t_19 = 0;
          __pyx_t_15 = 0;
          __pyx_t_198 = 0;
          __pyx_t_198 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_pa), __pyx_t_196);<span class='error_goto'> if (unlikely(__pyx_t_198 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          __pyx_t_196 = NULL;
          __pyx_t_16 = 0;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_17))) {
            __pyx_t_196 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_17);
            if (likely(__pyx_t_196)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_17);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_196);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_17, function);
              __pyx_t_16 = 1;
            }
          }
          __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          if (__pyx_t_196) {
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_196); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196); __pyx_t_196 = NULL;
          }
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_16, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_16, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          __pyx_t_12 = 0;
          __pyx_t_198 = 0;
          __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_17, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_t_17 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
            __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
            if (likely(__pyx_t_17)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
            }
          }
          if (!__pyx_t_17) {
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else {
            __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+1, __pyx_t_13);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
            __pyx_t_13 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_14, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_86, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_14);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_222 = __pyx_v_i;
          __pyx_t_223 = __pyx_v_n;
          __pyx_t_224 = -1;
          if (__pyx_t_222 &lt; 0) {
            __pyx_t_222 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_222 &lt; 0)) __pyx_t_224 = 0;
          } else if (unlikely(__pyx_t_222 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_224 = 0;
          if (__pyx_t_223 &lt; 0) {
            __pyx_t_223 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_223 &lt; 0)) __pyx_t_224 = 1;
          } else if (unlikely(__pyx_t_223 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_224 = 1;
          if (unlikely(__pyx_t_224 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_224);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_222, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_223, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;209:     # Rows relating to reactants</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+210:     for n in range(Nreac):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = __pyx_v_Nreac;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_n = __pyx_t_21;
</pre><pre class='cython line score-0'>&#xA0;211:         # Association loss</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+212:         for i in range(Nisom):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = __pyx_v_Nisom;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_i = __pyx_t_23;
</pre><pre class='cython line score-117' onclick='toggleDiv(this)'>+213:             K[Nisom+n,Nisom+n] = K[Nisom+n,Nisom+n] - numpy.sum(Fim[i,n,:,:] * eqDist[n+Nisom,:,:])</pre>
<pre class='cython code score-117'>      __pyx_t_170 = (__pyx_v_Nisom + __pyx_v_n);
      __pyx_t_188 = (__pyx_v_Nisom + __pyx_v_n);
      __pyx_t_202 = -1;
      if (__pyx_t_170 &lt; 0) {
        __pyx_t_170 += __pyx_pybuffernd_K.diminfo[0].shape;
        if (unlikely(__pyx_t_170 &lt; 0)) __pyx_t_202 = 0;
      } else if (unlikely(__pyx_t_170 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_202 = 0;
      if (__pyx_t_188 &lt; 0) {
        __pyx_t_188 += __pyx_pybuffernd_K.diminfo[1].shape;
        if (unlikely(__pyx_t_188 &lt; 0)) __pyx_t_202 = 1;
      } else if (unlikely(__pyx_t_188 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_202 = 1;
      if (unlikely(__pyx_t_202 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_202);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_170, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_188, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      __pyx_t_86 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_86, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
      __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
/* … */
  __pyx_slice__8 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
      __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_86);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1, __pyx_t_13);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 2, __pyx_slice__8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 3, __pyx_slice__9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__9);
      __pyx_t_86 = 0;
      __pyx_t_13 = 0;
      __pyx_t_13 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Fim), __pyx_t_17);<span class='error_goto'> if (unlikely(__pyx_t_13 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_n + __pyx_v_Nisom));<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_slice__9 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__9);
  __pyx_slice__10 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__10);
      __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_17);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__10);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1, __pyx_slice__10);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 2, __pyx_slice__11);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__11);
      __pyx_t_17 = 0;
      __pyx_t_17 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_eqDist), __pyx_t_86);<span class='error_goto'> if (unlikely(__pyx_t_17 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
      __pyx_t_86 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_13, __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
      __pyx_t_17 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
        __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
        if (likely(__pyx_t_17)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
        }
      }
      if (!__pyx_t_17) {
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_15, __pyx_t_86);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      } else {
        __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_17); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); __pyx_t_17 = NULL;
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+1, __pyx_t_86);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
        __pyx_t_86 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_15, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_15 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_14, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_15);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_202 = (__pyx_v_Nisom + __pyx_v_n);
      __pyx_t_203 = (__pyx_v_Nisom + __pyx_v_n);
      __pyx_t_224 = -1;
      if (__pyx_t_202 &lt; 0) {
        __pyx_t_202 += __pyx_pybuffernd_K.diminfo[0].shape;
        if (unlikely(__pyx_t_202 &lt; 0)) __pyx_t_224 = 0;
      } else if (unlikely(__pyx_t_202 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_224 = 0;
      if (__pyx_t_203 &lt; 0) {
        __pyx_t_203 += __pyx_pybuffernd_K.diminfo[1].shape;
        if (unlikely(__pyx_t_203 &lt; 0)) __pyx_t_224 = 1;
      } else if (unlikely(__pyx_t_203 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_224 = 1;
      if (unlikely(__pyx_t_224 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_224);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_202, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_203, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
    }
  __pyx_slice__11 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__11);
</pre><pre class='cython line score-0'>&#xA0;214:         # Reaction from isomer or reactant j to reactant n</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+215:         for j in range(Nisom+Nreac):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = (__pyx_v_Nisom + __pyx_v_Nreac);
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_j = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+216:             for i in range(Nisom):</pre>
<pre class='cython code score-0'>      __pyx_t_224 = __pyx_v_Nisom;
      for (__pyx_t_225 = 0; __pyx_t_225 &lt; __pyx_t_224; __pyx_t_225+=1) {
        __pyx_v_i = __pyx_t_225;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+217:                 for u in range(NJ):</pre>
<pre class='cython code score-0'>        __pyx_t_226 = __pyx_v_NJ;
        for (__pyx_t_227 = 0; __pyx_t_227 &lt; __pyx_t_226; __pyx_t_227+=1) {
          __pyx_v_u = __pyx_t_227;
</pre><pre class='cython line score-126' onclick='toggleDiv(this)'>+218:                     K[Nisom+n,j] = K[Nisom+n,j] + numpy.sum(Gnj[n,i,Nres[i,u]:Ngrains,u] * pa[i,j,Nres[i,u]:Ngrains,u])</pre>
<pre class='cython code score-126'>          __pyx_t_228 = (__pyx_v_Nisom + __pyx_v_n);
          __pyx_t_229 = __pyx_v_j;
          __pyx_t_230 = -1;
          if (__pyx_t_228 &lt; 0) {
            __pyx_t_228 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_228 &lt; 0)) __pyx_t_230 = 0;
          } else if (unlikely(__pyx_t_228 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_230 = 0;
          if (__pyx_t_229 &lt; 0) {
            __pyx_t_229 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_229 &lt; 0)) __pyx_t_230 = 1;
          } else if (unlikely(__pyx_t_229 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_230 = 1;
          if (unlikely(__pyx_t_230 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_230);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_15 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_228, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_229, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_230 = __pyx_v_i;
          __pyx_t_231 = __pyx_v_u;
          __pyx_t_232 = -1;
          if (__pyx_t_230 &lt; 0) {
            __pyx_t_230 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_230 &lt; 0)) __pyx_t_232 = 0;
          } else if (unlikely(__pyx_t_230 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_232 = 0;
          if (__pyx_t_231 &lt; 0) {
            __pyx_t_231 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_231 &lt; 0)) __pyx_t_232 = 1;
          } else if (unlikely(__pyx_t_231 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_232 = 1;
          if (unlikely(__pyx_t_232 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_232);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_230, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_231, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_12 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_17, __pyx_t_198, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          __pyx_t_17 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 0, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 1, __pyx_t_86);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 2, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_17, 3, __pyx_t_198);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_198);
          __pyx_t_14 = 0;
          __pyx_t_86 = 0;
          __pyx_t_12 = 0;
          __pyx_t_198 = 0;
          __pyx_t_198 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Gnj), __pyx_t_17);<span class='error_goto'> if (unlikely(__pyx_t_198 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_232 = __pyx_v_i;
          __pyx_t_233 = __pyx_v_u;
          __pyx_t_234 = -1;
          if (__pyx_t_232 &lt; 0) {
            __pyx_t_232 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_232 &lt; 0)) __pyx_t_234 = 0;
          } else if (unlikely(__pyx_t_232 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_234 = 0;
          if (__pyx_t_233 &lt; 0) {
            __pyx_t_233 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_233 &lt; 0)) __pyx_t_234 = 1;
          } else if (unlikely(__pyx_t_233 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_234 = 1;
          if (unlikely(__pyx_t_234 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_234);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_232, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_233, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_196 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_86, __pyx_t_14, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_17);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 2, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 3, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          __pyx_t_17 = 0;
          __pyx_t_12 = 0;
          __pyx_t_196 = 0;
          __pyx_t_14 = 0;
          __pyx_t_14 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_pa), __pyx_t_86);<span class='error_goto'> if (unlikely(__pyx_t_14 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          __pyx_t_86 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_198, __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
            __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
            if (likely(__pyx_t_14)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
            }
          }
          if (!__pyx_t_14) {
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_86);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else {
            __pyx_t_198 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 0, __pyx_t_14); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); __pyx_t_14 = NULL;
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_198, 0+1, __pyx_t_86);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
            __pyx_t_86 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_198, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_13 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_15, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_234 = (__pyx_v_Nisom + __pyx_v_n);
          __pyx_t_235 = __pyx_v_j;
          __pyx_t_236 = -1;
          if (__pyx_t_234 &lt; 0) {
            __pyx_t_234 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_234 &lt; 0)) __pyx_t_236 = 0;
          } else if (unlikely(__pyx_t_234 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_236 = 0;
          if (__pyx_t_235 &lt; 0) {
            __pyx_t_235 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_235 &lt; 0)) __pyx_t_236 = 1;
          } else if (unlikely(__pyx_t_235 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_236 = 1;
          if (unlikely(__pyx_t_236 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_236);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_234, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_235, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;219:     # Rows relating to products</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+220:     for n in range(Nreac, Nreac+Nprod):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = (__pyx_v_Nreac + __pyx_v_Nprod);
  for (__pyx_t_21 = __pyx_v_Nreac; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_n = __pyx_t_21;
</pre><pre class='cython line score-0'>&#xA0;221:         # Reaction from isomer or reactant j to product n</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+222:         for j in range(Nisom+Nreac):</pre>
<pre class='cython code score-0'>    __pyx_t_22 = (__pyx_v_Nisom + __pyx_v_Nreac);
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_j = __pyx_t_23;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+223:             for i in range(Nisom):</pre>
<pre class='cython code score-0'>      __pyx_t_224 = __pyx_v_Nisom;
      for (__pyx_t_225 = 0; __pyx_t_225 &lt; __pyx_t_224; __pyx_t_225+=1) {
        __pyx_v_i = __pyx_t_225;
</pre><pre class='cython line score-0' onclick='toggleDiv(this)'>+224:                 for u in range(NJ):</pre>
<pre class='cython code score-0'>        __pyx_t_226 = __pyx_v_NJ;
        for (__pyx_t_227 = 0; __pyx_t_227 &lt; __pyx_t_226; __pyx_t_227+=1) {
          __pyx_v_u = __pyx_t_227;
</pre><pre class='cython line score-126' onclick='toggleDiv(this)'>+225:                     K[Nisom+n,j] = K[Nisom+n,j] + numpy.sum(Gnj[n,i,Nres[i,u]:Ngrains,u] * pa[i,j,Nres[i,u]:Ngrains,u])</pre>
<pre class='cython code score-126'>          __pyx_t_236 = (__pyx_v_Nisom + __pyx_v_n);
          __pyx_t_237 = __pyx_v_j;
          __pyx_t_238 = -1;
          if (__pyx_t_236 &lt; 0) {
            __pyx_t_236 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_236 &lt; 0)) __pyx_t_238 = 0;
          } else if (unlikely(__pyx_t_236 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_238 = 0;
          if (__pyx_t_237 &lt; 0) {
            __pyx_t_237 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_237 &lt; 0)) __pyx_t_238 = 1;
          } else if (unlikely(__pyx_t_237 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_238 = 1;
          if (unlikely(__pyx_t_238 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_238);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_13 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_236, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_237, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_198 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_238 = __pyx_v_i;
          __pyx_t_239 = __pyx_v_u;
          __pyx_t_240 = -1;
          if (__pyx_t_238 &lt; 0) {
            __pyx_t_238 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_238 &lt; 0)) __pyx_t_240 = 0;
          } else if (unlikely(__pyx_t_238 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_240 = 0;
          if (__pyx_t_239 &lt; 0) {
            __pyx_t_239 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_239 &lt; 0)) __pyx_t_240 = 1;
          } else if (unlikely(__pyx_t_239 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_240 = 1;
          if (unlikely(__pyx_t_240 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_240);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_238, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_239, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_12 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_14, __pyx_t_196, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_15);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1, __pyx_t_86);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 3, __pyx_t_196);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_196);
          __pyx_t_15 = 0;
          __pyx_t_86 = 0;
          __pyx_t_12 = 0;
          __pyx_t_196 = 0;
          __pyx_t_196 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Gnj), __pyx_t_14);<span class='error_goto'> if (unlikely(__pyx_t_196 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          __pyx_t_240 = __pyx_v_i;
          __pyx_t_241 = __pyx_v_u;
          __pyx_t_242 = -1;
          if (__pyx_t_240 &lt; 0) {
            __pyx_t_240 += __pyx_pybuffernd_Nres.diminfo[0].shape;
            if (unlikely(__pyx_t_240 &lt; 0)) __pyx_t_242 = 0;
          } else if (unlikely(__pyx_t_240 &gt;= __pyx_pybuffernd_Nres.diminfo[0].shape)) __pyx_t_242 = 0;
          if (__pyx_t_241 &lt; 0) {
            __pyx_t_241 += __pyx_pybuffernd_Nres.diminfo[1].shape;
            if (unlikely(__pyx_t_241 &lt; 0)) __pyx_t_242 = 1;
          } else if (unlikely(__pyx_t_241 &gt;= __pyx_pybuffernd_Nres.diminfo[1].shape)) __pyx_t_242 = 1;
          if (unlikely(__pyx_t_242 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_242);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_86 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_Nres.rcbuffer-&gt;pybuffer.buf, __pyx_t_240, __pyx_pybuffernd_Nres.diminfo[0].strides, __pyx_t_241, __pyx_pybuffernd_Nres.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_Ngrains);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_17 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_86, __pyx_t_15, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_u);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_t_14);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1, __pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 2, __pyx_t_17);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 3, __pyx_t_15);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
          __pyx_t_14 = 0;
          __pyx_t_12 = 0;
          __pyx_t_17 = 0;
          __pyx_t_15 = 0;
          __pyx_t_15 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_pa), __pyx_t_86);<span class='error_goto'> if (unlikely(__pyx_t_15 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
          __pyx_t_86 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_196, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          __pyx_t_15 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_198))) {
            __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_198);
            if (likely(__pyx_t_15)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_198);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_198, function);
            }
          }
          if (!__pyx_t_15) {
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_198, __pyx_t_86);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          } else {
            __pyx_t_196 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 0, __pyx_t_15); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15); __pyx_t_15 = NULL;
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 0+1, __pyx_t_86);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86);
            __pyx_t_86 = 0;
            __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_198, __pyx_t_196, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          __pyx_t_198 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_13, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_198);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
          __pyx_t_242 = (__pyx_v_Nisom + __pyx_v_n);
          __pyx_t_243 = __pyx_v_j;
          __pyx_t_244 = -1;
          if (__pyx_t_242 &lt; 0) {
            __pyx_t_242 += __pyx_pybuffernd_K.diminfo[0].shape;
            if (unlikely(__pyx_t_242 &lt; 0)) __pyx_t_244 = 0;
          } else if (unlikely(__pyx_t_242 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_244 = 0;
          if (__pyx_t_243 &lt; 0) {
            __pyx_t_243 += __pyx_pybuffernd_K.diminfo[1].shape;
            if (unlikely(__pyx_t_243 &lt; 0)) __pyx_t_244 = 1;
          } else if (unlikely(__pyx_t_243 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_244 = 1;
          if (unlikely(__pyx_t_244 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_244);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_242, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_243, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
        }
      }
    }
  }
</pre><pre class='cython line score-0'>&#xA0;226: </pre>
<pre class='cython line score-0'>&#xA0;227:     # Ensure matrix is conservative</pre>
<pre class='cython line score-0' onclick='toggleDiv(this)'>+228:     for n in range(Nisom+Nreac):</pre>
<pre class='cython code score-0'>  __pyx_t_4 = (__pyx_v_Nisom + __pyx_v_Nreac);
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_4; __pyx_t_21+=1) {
    __pyx_v_n = __pyx_t_21;
</pre><pre class='cython line score-72' onclick='toggleDiv(this)'>+229:         K[n,n] = K[n,n] - numpy.sum(K[:,n])</pre>
<pre class='cython code score-72'>    __pyx_t_22 = __pyx_v_n;
    __pyx_t_23 = __pyx_v_n;
    __pyx_t_224 = -1;
    if (__pyx_t_22 &lt; 0) {
      __pyx_t_22 += __pyx_pybuffernd_K.diminfo[0].shape;
      if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_224 = 0;
    } else if (unlikely(__pyx_t_22 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_224 = 0;
    if (__pyx_t_23 &lt; 0) {
      __pyx_t_23 += __pyx_pybuffernd_K.diminfo[1].shape;
      if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_224 = 1;
    } else if (unlikely(__pyx_t_23 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_224 = 1;
    if (unlikely(__pyx_t_224 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_224);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_198 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_23, __pyx_pybuffernd_K.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_198)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_198);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_196 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_86 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_86);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__12);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 0, __pyx_slice__12);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__12);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_86, 1, __pyx_t_13);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
    __pyx_t_13 = 0;
    __pyx_t_13 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_K), __pyx_t_86);<span class='error_goto'> if (unlikely(__pyx_t_13 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_86); __pyx_t_86 = 0;
    __pyx_t_86 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_196))) {
      __pyx_t_86 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_196);
      if (likely(__pyx_t_86)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_196);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_86);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_196, function);
      }
    }
    if (!__pyx_t_86) {
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_196, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else {
      __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_86); <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_86); __pyx_t_86 = NULL;
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+1, __pyx_t_13);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      __pyx_t_13 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_196, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
    __pyx_t_196 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_198, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_198); __pyx_t_198 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_89 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_196);<span class='error_goto'> if (unlikely((__pyx_t_89 == (npy_float64)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_196); __pyx_t_196 = 0;
    __pyx_t_224 = __pyx_v_n;
    __pyx_t_225 = __pyx_v_n;
    __pyx_t_226 = -1;
    if (__pyx_t_224 &lt; 0) {
      __pyx_t_224 += __pyx_pybuffernd_K.diminfo[0].shape;
      if (unlikely(__pyx_t_224 &lt; 0)) __pyx_t_226 = 0;
    } else if (unlikely(__pyx_t_224 &gt;= __pyx_pybuffernd_K.diminfo[0].shape)) __pyx_t_226 = 0;
    if (__pyx_t_225 &lt; 0) {
      __pyx_t_225 += __pyx_pybuffernd_K.diminfo[1].shape;
      if (unlikely(__pyx_t_225 &lt; 0)) __pyx_t_226 = 1;
    } else if (unlikely(__pyx_t_225 &gt;= __pyx_pybuffernd_K.diminfo[1].shape)) __pyx_t_226 = 1;
    if (unlikely(__pyx_t_226 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_226);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_K.rcbuffer-&gt;pybuffer.buf, __pyx_t_224, __pyx_pybuffernd_K.diminfo[0].strides, __pyx_t_225, __pyx_pybuffernd_K.diminfo[1].strides) = __pyx_t_89;
  }
/* … */
  __pyx_slice__12 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__12);
</pre><pre class='cython line score-0'>&#xA0;230: </pre>
<pre class='cython line score-0'>&#xA0;231:     # Return the matrix of k(T,P) values and the pseudo-steady population distributions</pre>
<pre class='cython line score-10' onclick='toggleDiv(this)'>+232:     return K, pa</pre>
<pre class='cython code score-10'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_196 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_196)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_196);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_K));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 0, ((PyObject *)__pyx_v_K));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_K));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_pa));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_196, 1, ((PyObject *)__pyx_v_pa));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_pa));
  __pyx_r = __pyx_t_196;
  __pyx_t_196 = 0;
  goto __pyx_L0;
</pre></div></body></html>
